<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Django | 我的博客</title>
    <meta name="generator" content="VuePress 1.4.1">
    
    <meta name="description" content="">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="preload" href="/blog-web/assets/css/0.styles.7d8f2a25.css" as="style"><link rel="preload" href="/blog-web/assets/js/app.1e93224c.js" as="script"><link rel="preload" href="/blog-web/assets/js/2.7ae4b6a2.js" as="script"><link rel="preload" href="/blog-web/assets/js/14.0f3679a0.js" as="script"><link rel="prefetch" href="/blog-web/assets/js/10.503085c4.js"><link rel="prefetch" href="/blog-web/assets/js/100.a5d002c1.js"><link rel="prefetch" href="/blog-web/assets/js/101.931eb6f3.js"><link rel="prefetch" href="/blog-web/assets/js/102.d6333c04.js"><link rel="prefetch" href="/blog-web/assets/js/103.f7b9cd01.js"><link rel="prefetch" href="/blog-web/assets/js/104.8dd71d52.js"><link rel="prefetch" href="/blog-web/assets/js/105.6a9d0b55.js"><link rel="prefetch" href="/blog-web/assets/js/11.174f1888.js"><link rel="prefetch" href="/blog-web/assets/js/12.4c9fe3c0.js"><link rel="prefetch" href="/blog-web/assets/js/13.3ba611aa.js"><link rel="prefetch" href="/blog-web/assets/js/15.0879e1c6.js"><link rel="prefetch" href="/blog-web/assets/js/16.f928cb4f.js"><link rel="prefetch" href="/blog-web/assets/js/17.467e09a5.js"><link rel="prefetch" href="/blog-web/assets/js/18.60b0105b.js"><link rel="prefetch" href="/blog-web/assets/js/19.30d39ecf.js"><link rel="prefetch" href="/blog-web/assets/js/20.2f3cd3cf.js"><link rel="prefetch" href="/blog-web/assets/js/21.85aeac5c.js"><link rel="prefetch" href="/blog-web/assets/js/22.5f85175f.js"><link rel="prefetch" href="/blog-web/assets/js/23.56e4aff3.js"><link rel="prefetch" href="/blog-web/assets/js/24.10e666f4.js"><link rel="prefetch" href="/blog-web/assets/js/25.51ab829c.js"><link rel="prefetch" href="/blog-web/assets/js/26.75ec69f1.js"><link rel="prefetch" href="/blog-web/assets/js/27.f3068f7f.js"><link rel="prefetch" href="/blog-web/assets/js/28.1093f02e.js"><link rel="prefetch" href="/blog-web/assets/js/29.89205f82.js"><link rel="prefetch" href="/blog-web/assets/js/3.e34a90bc.js"><link rel="prefetch" href="/blog-web/assets/js/30.cfb29a13.js"><link rel="prefetch" href="/blog-web/assets/js/31.ccc2c449.js"><link rel="prefetch" href="/blog-web/assets/js/32.565918ae.js"><link rel="prefetch" href="/blog-web/assets/js/33.213c7c37.js"><link rel="prefetch" href="/blog-web/assets/js/34.7c68eb12.js"><link rel="prefetch" href="/blog-web/assets/js/35.c30f3443.js"><link rel="prefetch" href="/blog-web/assets/js/36.f27cd116.js"><link rel="prefetch" href="/blog-web/assets/js/37.953a636d.js"><link rel="prefetch" href="/blog-web/assets/js/38.f6841cf2.js"><link rel="prefetch" href="/blog-web/assets/js/39.de8767f6.js"><link rel="prefetch" href="/blog-web/assets/js/4.3aabfd60.js"><link rel="prefetch" href="/blog-web/assets/js/40.08ae1af3.js"><link rel="prefetch" href="/blog-web/assets/js/41.1702634e.js"><link rel="prefetch" href="/blog-web/assets/js/42.153eb6c7.js"><link rel="prefetch" href="/blog-web/assets/js/43.3a3ebfe0.js"><link rel="prefetch" href="/blog-web/assets/js/44.caf0eee2.js"><link rel="prefetch" href="/blog-web/assets/js/45.42dbf120.js"><link rel="prefetch" href="/blog-web/assets/js/46.126848f4.js"><link rel="prefetch" href="/blog-web/assets/js/47.3cd48aa0.js"><link rel="prefetch" href="/blog-web/assets/js/48.20cada15.js"><link rel="prefetch" href="/blog-web/assets/js/49.04f52526.js"><link rel="prefetch" href="/blog-web/assets/js/5.2e8e35bb.js"><link rel="prefetch" href="/blog-web/assets/js/50.26fba8c5.js"><link rel="prefetch" href="/blog-web/assets/js/51.8ea98f02.js"><link rel="prefetch" href="/blog-web/assets/js/52.dc033cb6.js"><link rel="prefetch" href="/blog-web/assets/js/53.ee78f44d.js"><link rel="prefetch" href="/blog-web/assets/js/54.21f383e9.js"><link rel="prefetch" href="/blog-web/assets/js/55.f6be4f63.js"><link rel="prefetch" href="/blog-web/assets/js/56.7115055a.js"><link rel="prefetch" href="/blog-web/assets/js/57.a68db464.js"><link rel="prefetch" href="/blog-web/assets/js/58.5b991045.js"><link rel="prefetch" href="/blog-web/assets/js/59.125c9aa4.js"><link rel="prefetch" href="/blog-web/assets/js/6.3a266898.js"><link rel="prefetch" href="/blog-web/assets/js/60.413e7e50.js"><link rel="prefetch" href="/blog-web/assets/js/61.7f3aacd0.js"><link rel="prefetch" href="/blog-web/assets/js/62.de4321c3.js"><link rel="prefetch" href="/blog-web/assets/js/63.2e978c52.js"><link rel="prefetch" href="/blog-web/assets/js/64.8aa3a4e6.js"><link rel="prefetch" href="/blog-web/assets/js/65.dd1639fd.js"><link rel="prefetch" href="/blog-web/assets/js/66.7c4ed292.js"><link rel="prefetch" href="/blog-web/assets/js/67.d51468f1.js"><link rel="prefetch" href="/blog-web/assets/js/68.799220e1.js"><link rel="prefetch" href="/blog-web/assets/js/69.497c09b7.js"><link rel="prefetch" href="/blog-web/assets/js/7.2de9b0d5.js"><link rel="prefetch" href="/blog-web/assets/js/70.ca84da1b.js"><link rel="prefetch" href="/blog-web/assets/js/71.6ae7b02f.js"><link rel="prefetch" href="/blog-web/assets/js/72.ef92562b.js"><link rel="prefetch" href="/blog-web/assets/js/73.c0282258.js"><link rel="prefetch" href="/blog-web/assets/js/74.fba96785.js"><link rel="prefetch" href="/blog-web/assets/js/75.62a1a267.js"><link rel="prefetch" href="/blog-web/assets/js/76.3e3ab859.js"><link rel="prefetch" href="/blog-web/assets/js/77.b95e4a18.js"><link rel="prefetch" href="/blog-web/assets/js/78.e9ee6aea.js"><link rel="prefetch" href="/blog-web/assets/js/79.35bb30b6.js"><link rel="prefetch" href="/blog-web/assets/js/8.ea42fe1e.js"><link rel="prefetch" href="/blog-web/assets/js/80.549fe728.js"><link rel="prefetch" href="/blog-web/assets/js/81.88386f31.js"><link rel="prefetch" href="/blog-web/assets/js/82.12d3c156.js"><link rel="prefetch" href="/blog-web/assets/js/83.da9da420.js"><link rel="prefetch" href="/blog-web/assets/js/84.8991b357.js"><link rel="prefetch" href="/blog-web/assets/js/85.aa316cdb.js"><link rel="prefetch" href="/blog-web/assets/js/86.95d3e717.js"><link rel="prefetch" href="/blog-web/assets/js/87.1010a308.js"><link rel="prefetch" href="/blog-web/assets/js/88.cc54b0ae.js"><link rel="prefetch" href="/blog-web/assets/js/89.40ca71ea.js"><link rel="prefetch" href="/blog-web/assets/js/9.95029bd8.js"><link rel="prefetch" href="/blog-web/assets/js/90.7235cab1.js"><link rel="prefetch" href="/blog-web/assets/js/91.24b50650.js"><link rel="prefetch" href="/blog-web/assets/js/92.a4144934.js"><link rel="prefetch" href="/blog-web/assets/js/93.92382b5e.js"><link rel="prefetch" href="/blog-web/assets/js/94.971bacc2.js"><link rel="prefetch" href="/blog-web/assets/js/95.69b262b8.js"><link rel="prefetch" href="/blog-web/assets/js/96.86d72ddb.js"><link rel="prefetch" href="/blog-web/assets/js/97.ff12a35c.js"><link rel="prefetch" href="/blog-web/assets/js/98.370de041.js"><link rel="prefetch" href="/blog-web/assets/js/99.7e494cfa.js">
    <link rel="stylesheet" href="/blog-web/assets/css/0.styles.7d8f2a25.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog-web/" class="home-link router-link-active"><!----> <span class="site-name">我的博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog-web/web/" class="nav-link">
  Web
</a></div><div class="nav-item"><a href="/blog-web/vue/" class="nav-link">
  VUE
</a></div><div class="nav-item"><a href="/blog-web/bigData/" class="nav-link router-link-active">
  后端
</a></div><div class="nav-item"><a href="/blog-web/git/" class="nav-link">
  Git
</a></div><div class="nav-item"><a href="/blog-web/install/" class="nav-link">
  安装
</a></div><div class="nav-item"><a href="/blog-web/other/" class="nav-link">
  其他
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog-web/web/" class="nav-link">
  Web
</a></div><div class="nav-item"><a href="/blog-web/vue/" class="nav-link">
  VUE
</a></div><div class="nav-item"><a href="/blog-web/bigData/" class="nav-link router-link-active">
  后端
</a></div><div class="nav-item"><a href="/blog-web/git/" class="nav-link">
  Git
</a></div><div class="nav-item"><a href="/blog-web/install/" class="nav-link">
  安装
</a></div><div class="nav-item"><a href="/blog-web/other/" class="nav-link">
  其他
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>后端技术总结</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog-web/bigData/" class="sidebar-link">Introduction</a></li><li><a href="/blog-web/bigData/mysql.html" class="sidebar-link">MySql</a></li><li><a href="/blog-web/bigData/redis.html" class="sidebar-link">redis基础</a></li><li><a href="/blog-web/bigData/es.html" class="sidebar-link">Elasticsearch</a></li><li><a href="/blog-web/bigData/kylin.html" class="sidebar-link">Kylin知识整理</a></li><li><a href="/blog-web/bigData/hybrid.html" class="sidebar-link">hybrid优化总结</a></li><li><a href="/blog-web/bigData/python.html" class="sidebar-link">Python</a></li><li><a href="/blog-web/bigData/pandas.html" class="sidebar-link">pandas</a></li><li><a href="/blog-web/bigData/django.html" class="active sidebar-link">Django</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog-web/bigData/django.html#一、mvc-设计模式" class="sidebar-link">一、MVC 设计模式</a></li><li class="sidebar-sub-header"><a href="/blog-web/bigData/django.html#二、django安装" class="sidebar-link">二、Django安装</a></li><li class="sidebar-sub-header"><a href="/blog-web/bigData/django.html#三、创建第一个项目" class="sidebar-link">三、创建第一个项目</a></li><li class="sidebar-sub-header"><a href="/blog-web/bigData/django.html#四、url说明" class="sidebar-link">四、URL说明</a></li><li class="sidebar-sub-header"><a href="/blog-web/bigData/django.html#五、settings文件说明" class="sidebar-link">五、settings文件说明</a></li><li class="sidebar-sub-header"><a href="/blog-web/bigData/django.html#六、model中的meta" class="sidebar-link">六、Model中的Meta</a></li><li class="sidebar-sub-header"><a href="/blog-web/bigData/django.html#七、常用的字段参数" class="sidebar-link">七、常用的字段参数</a></li><li class="sidebar-sub-header"><a href="/blog-web/bigData/django.html#八、基本查询" class="sidebar-link">八、基本查询</a></li><li class="sidebar-sub-header"><a href="/blog-web/bigData/django.html#九、数据的增删改" class="sidebar-link">九、数据的增删改</a></li><li class="sidebar-sub-header"><a href="/blog-web/bigData/django.html#十、关系操作" class="sidebar-link">十、关系操作</a></li><li class="sidebar-sub-header"><a href="/blog-web/bigData/django.html#十一、类继承" class="sidebar-link">十一、类继承</a></li><li class="sidebar-sub-header"><a href="/blog-web/bigData/django.html#十二、模板-过滤器" class="sidebar-link">十二、模板 - 过滤器</a></li><li class="sidebar-sub-header"><a href="/blog-web/bigData/django.html#十三、admin管理模板" class="sidebar-link">十三、Admin管理模板</a></li><li class="sidebar-sub-header"><a href="/blog-web/bigData/django.html#十四、auth模块" class="sidebar-link">十四、auth模块</a></li><li class="sidebar-sub-header"><a href="/blog-web/bigData/django.html#十五、其他查询" class="sidebar-link">十五、其他查询</a></li><li class="sidebar-sub-header"><a href="/blog-web/bigData/django.html#说明一、django支持的数据库" class="sidebar-link">说明一、Django支持的数据库</a></li><li class="sidebar-sub-header"><a href="/blog-web/bigData/django.html#说明二、正则表达式" class="sidebar-link">说明二、正则表达式</a></li><li class="sidebar-sub-header"><a href="/blog-web/bigData/django.html#widthratio" class="sidebar-link">widthratio</a></li><li class="sidebar-sub-header"><a href="/blog-web/bigData/django.html#清理cache缓存-django-cache" class="sidebar-link">清理cache缓存(Django Cache)</a></li><li class="sidebar-sub-header"><a href="/blog-web/bigData/django.html#cgi" class="sidebar-link">CGI</a></li><li class="sidebar-sub-header"><a href="/blog-web/bigData/django.html#处理步骤编辑" class="sidebar-link">处理步骤编辑</a></li><li class="sidebar-sub-header"><a href="/blog-web/bigData/django.html#mvc-设计模式" class="sidebar-link">MVC 设计模式</a></li><li class="sidebar-sub-header"><a href="/blog-web/bigData/django.html#部署django" class="sidebar-link">部署Django</a></li><li class="sidebar-sub-header"><a href="/blog-web/bigData/django.html#django字段类型清单" class="sidebar-link">Django字段类型清单</a></li><li class="sidebar-sub-header"><a href="/blog-web/bigData/django.html#field选项" class="sidebar-link">Field选项</a></li><li class="sidebar-sub-header"><a href="/blog-web/bigData/django.html#oauth-第三方登录" class="sidebar-link">OAuth 第三方登录</a></li></ul></li><li><a href="/blog-web/bigData/linux.html" class="sidebar-link">Linux基础</a></li><li><a href="/blog-web/bigData/nginx.html" class="sidebar-link">Nginx配置</a></li><li><a href="/blog-web/bigData/aws-s3.html" class="sidebar-link">aws s3 命令</a></li><li><a href="/blog-web/bigData/hive.html" class="sidebar-link">hive</a></li><li><a href="/blog-web/bigData/hdfs.html" class="sidebar-link">DHFS基础</a></li><li><a href="/blog-web/bigData/hbase.html" class="sidebar-link">HBASE</a></li><li><a href="/blog-web/bigData/spark.html" class="sidebar-link">Spark</a></li><li><a href="/blog-web/bigData/luigi.html" class="sidebar-link">Luigi和sciluigi</a></li><li><a href="/blog-web/bigData/scala.html" class="sidebar-link">scala基础</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="django"><a href="#django" class="header-anchor">#</a> Django</h1> <blockquote><p>Django 是用 Python 编写的一组类库,可以运行在任何Python可以运行的环境，于2003年诞生，最初用于开发新闻网站
Django 代码向后兼容，例：1.1写的应用，适用于1.2、1.3等之后的版本，但不一定适用于2.0以后的版本</p></blockquote> <ul><li><a href="https://www.python.org/downloads/" target="_blank" rel="noopener noreferrer">Python安装包<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://www.djangoproject.com/download/" target="_blank" rel="noopener noreferrer">Django安装包<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://sourceforge.net/projects/mysql-python/" target="_blank" rel="noopener noreferrer">mysql-python安装包<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="http://www.cnblogs.com/Finley/p/5575305.html" target="_blank" rel="noopener noreferrer">django的auth<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://docs.djangoproject.com/en/1.11/topics/pagination/" target="_blank" rel="noopener noreferrer">Django分页<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="http://djangobook.py3k.cn/2.0/" target="_blank" rel="noopener noreferrer">django官方文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="http://www.ziqiangxuetang.com/django/django-tutorial.html" target="_blank" rel="noopener noreferrer">参考文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="http://yshblog.com/blog/87" target="_blank" rel="noopener noreferrer">常用的admin配置<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <h2 id="一、mvc-设计模式"><a href="#一、mvc-设计模式" class="header-anchor">#</a> 一、MVC 设计模式</h2> <blockquote><p>MVC 是一种软件开发的方法，它把代码的定义和数据访问的方法（模型）与请求逻辑 （控制器）还有用户接口（视图）分开来</p></blockquote> <ul><li>mode.py : 模型，用Python类来描述数据表，可以通过简单的Python代码来创建、检索、更新、删除数据库的记录，不需要写SQL</li> <li>views.py : 视图，页面的业务逻辑，通过Python函数来实现</li> <li>urls.py : 控制器，指出不同的URL调用不同的视图</li> <li>xxx.html ：html模板，描述了页面的设计</li></ul> <h2 id="二、django安装"><a href="#二、django安装" class="header-anchor">#</a> 二、Django安装</h2> <div class="language-sh extra-class"><pre class="language-sh"><code>$ python -V   <span class="token comment"># 查新当前的Python版本，确保当前环境已经安装了Python</span>
$ yum -y <span class="token function">install</span> python-setuptools  
$ easy_install pip
$ pip <span class="token function">install</span> django
</code></pre></div><h2 id="三、创建第一个项目"><a href="#三、创建第一个项目" class="header-anchor">#</a> 三、创建第一个项目</h2> <p>创建项目</p> <div class="language-sh extra-class"><pre class="language-sh"><code>$ django-admin.py startproject test_pro     <span class="token comment"># 创建项目</span>
$ <span class="token function">chmod</span> +x django-admin.py      <span class="token comment"># 如果权限拒绝，运行此命令</span>
$ django-admin startapp app1    <span class="token comment"># 创建应用</span>
$ python manage.py runserver    <span class="token comment"># 启动服务，默认访问127.0.0.1:8000/url/</span>
<span class="token comment"># 项目存放位置最好是根目录(root)之外的位置，因为放到根目录有使人通过网络看到源代码的风险</span>
</code></pre></div><p>配置视图(app.views.py)</p> <div class="language-py extra-class"><pre class="language-py"><code><span class="token comment"># -*- coding: utf-8 -*-</span>
<span class="token keyword">from</span> __future__ <span class="token keyword">import</span> unicode_literals
<span class="token keyword">from</span> django<span class="token punctuation">.</span>http <span class="token keyword">import</span> HttpResponse

<span class="token keyword">def</span> <span class="token function">hello_world</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span><span class="token string">&quot;Hello World&quot;</span><span class="token punctuation">)</span>
</code></pre></div><p>配置URL(pro.urls.py)</p> <div class="language-py extra-class"><pre class="language-py"><code><span class="token keyword">from</span> django<span class="token punctuation">.</span>conf<span class="token punctuation">.</span>urls <span class="token keyword">import</span> url
<span class="token comment"># from app.views import hello</span>
<span class="token keyword">from</span> app <span class="token keyword">import</span> views

urlpatterns <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token comment"># url(r'^hello/$', hello),</span>
    url<span class="token punctuation">(</span><span class="token string">r'^hello/'</span>$<span class="token punctuation">,</span> views<span class="token punctuation">.</span>hello_world<span class="token punctuation">)</span><span class="token punctuation">,</span>         <span class="token comment"># 称作URLpattern</span>
    <span class="token comment"># url(r'^hello/\d{1,2}/$', views.hello_world),    </span>
<span class="token punctuation">]</span>
</code></pre></div><h2 id="四、url说明"><a href="#四、url说明" class="header-anchor">#</a> 四、URL说明</h2> <blockquote><p>松耦合：更新一个模块不会影响其他模块的改变</p></blockquote> <p>pro下的URL</p> <div class="language-py extra-class"><pre class="language-py"><code><span class="token keyword">from</span> django<span class="token punctuation">.</span>conf<span class="token punctuation">.</span>urls <span class="token keyword">import</span> url
<span class="token keyword">from</span> django<span class="token punctuation">.</span>conf<span class="token punctuation">.</span>urls <span class="token keyword">import</span> include
<span class="token comment"># from app.views import hello</span>
<span class="token keyword">from</span> app <span class="token keyword">import</span> views

urlpatterns <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token comment"># url(r'^hello/', hello),</span>
    url<span class="token punctuation">(</span><span class="token string">r'^hello/$'</span><span class="token punctuation">,</span> views<span class="token punctuation">.</span>hello_world<span class="token punctuation">)</span><span class="token punctuation">,</span>         <span class="token comment"># 称作URLpattern</span>
    url<span class="token punctuation">(</span><span class="token string">r'^app/'</span><span class="token punctuation">,</span> include<span class="token punctuation">(</span><span class="token string">'app.urls'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token comment"># 映射对应项目的URL</span>
<span class="token punctuation">]</span>

<span class="token comment"># -----------------说明----------------</span>
<span class="token number">1</span><span class="token punctuation">.</span> URLpattern是一个Python的元组，元组中第一个元素是模式匹配字符串（正则表达式）；第二个元素是那个模式将使用的视图函数
<span class="token number">2</span><span class="token punctuation">.</span> Django在检查URL模式前，移除每一个申请的URL开头的斜杠<span class="token punctuation">(</span><span class="token operator">/</span><span class="token punctuation">)</span>，这意味着为<span class="token operator">/</span>hello<span class="token operator">/</span>写URL模式不用包含斜杠<span class="token punctuation">(</span><span class="token operator">/</span><span class="token punctuation">)</span>
</code></pre></div><p>app应用下的URL</p> <div class="language-py extra-class"><pre class="language-py"><code><span class="token keyword">from</span> django<span class="token punctuation">.</span>conf<span class="token punctuation">.</span>urls <span class="token keyword">import</span> url
<span class="token keyword">from</span> app <span class="token keyword">import</span> views

urlpatterns <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token comment"># url(r'^$', views.index), </span>
    url<span class="token punctuation">(</span><span class="token string">r'^index/$'</span><span class="token punctuation">,</span> views<span class="token punctuation">.</span>index<span class="token punctuation">)</span><span class="token punctuation">,</span>
    url<span class="token punctuation">(</span><span class="token string">r'^get_user/$'</span><span class="token punctuation">,</span> views<span class="token punctuation">.</span>get_user<span class="token punctuation">)</span><span class="token punctuation">,</span>
    url<span class="token punctuation">(</span><span class="token string">r'^get_user1/$'</span><span class="token punctuation">,</span> views<span class="token punctuation">.</span>get_user1<span class="token punctuation">)</span><span class="token punctuation">,</span>
    url<span class="token punctuation">(</span><span class="token string">r'^get_user2/$'</span><span class="token punctuation">,</span> views<span class="token punctuation">.</span>get_user2<span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
</code></pre></div><h2 id="五、settings文件说明"><a href="#五、settings文件说明" class="header-anchor">#</a> 五、settings文件说明</h2> <div class="language-py extra-class"><pre class="language-py"><code><span class="token comment"># Django通过在ROOT_URLCONF配置来决定根URLconf</span>
ROOT_URLCONF <span class="token operator">=</span> <span class="token string">'pro.urls'</span>
<span class="token comment"># LANGUAGE_CODE用于指定翻译语言,翻译语言文件存放位置：site-packages/django/conf/locale</span>
<span class="token comment"># zh_Hans:中文简体，zh_Hant：中文繁体</span>
LANGUAGE_CODE <span class="token operator">=</span> <span class="token string">'zh-hans'</span>
<span class="token comment"># 设置时区，北京常用'Asia/Shanghai'，也有用'PRC'的</span>
TIME_ZONE <span class="token operator">=</span> <span class="token string">'Asia/Shanghai'</span>
<span class="token comment"># debug 模式 设为False，原因见下面说明</span>
DEBUG <span class="token operator">=</span> <span class="token boolean">False</span>
<span class="token comment"># 修改模板文件路径 为 项目目录下的templates目录(pro/templates)</span>
BASE_DIR <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>dirname<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>dirname<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>abspath<span class="token punctuation">(</span>__file__<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
temp_dir <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>BASE_DIR<span class="token punctuation">,</span> <span class="token string">'templates'</span><span class="token punctuation">)</span>
TEMPLATES <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        <span class="token string">'BACKEND'</span><span class="token punctuation">:</span> <span class="token string">'django.template.backends.django.DjangoTemplates'</span><span class="token punctuation">,</span>
        <span class="token string">'DIRS'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>temp_dir<span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token string">'APP_DIRS'</span><span class="token punctuation">:</span> <span class="token boolean">True</span><span class="token punctuation">,</span>
        <span class="token string">'OPTIONS'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
            <span class="token string">'context_processors'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
                <span class="token string">'django.template.context_processors.debug'</span><span class="token punctuation">,</span>
                <span class="token string">'django.template.context_processors.request'</span><span class="token punctuation">,</span>
                <span class="token string">'django.contrib.auth.context_processors.auth'</span><span class="token punctuation">,</span>
                <span class="token string">'django.contrib.messages.context_processors.messages'</span><span class="token punctuation">,</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>

</code></pre></div><p><strong>关闭Debug模式</strong></p> <div class="language-py extra-class"><pre class="language-py"><code>Django 服务器在开启时默认运行在 debug 模式，Django 出错信息仅在 debug 模式下才会显现
settings<span class="token punctuation">.</span>py文件中的DEBUG默认设置为<span class="token boolean">True</span>，表示DEBUG模式开启，此时会导致如下几个问题：
<span class="token number">1</span><span class="token punctuation">.</span>所有的数据库查询将被保存在内存中，以django<span class="token punctuation">.</span>db<span class="token punctuation">.</span>connection<span class="token punctuation">.</span>queries的形式<span class="token punctuation">.</span>会很吃内存。
<span class="token number">2</span><span class="token punctuation">.</span>任何<span class="token number">404</span>错误都将呈现Django的包含敏感信息的页面，而不是普通的<span class="token number">404</span>页面。
<span class="token number">3</span><span class="token punctuation">.</span>应用中任何未捕获的异常、错误的python语法、错误的模板语法等都会返回包含敏感信息的Django错误页面。
</code></pre></div><h2 id="六、model中的meta"><a href="#六、model中的meta" class="header-anchor">#</a> 六、Model中的Meta</h2> <blockquote><p>Meta是Django的一个内部类，用于定义Django模型层的元数据（数据库表名，数据默认排序方式等）</p></blockquote> <div class="language-py extra-class"><pre class="language-py"><code>sex_choices <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">'f'</span><span class="token punctuation">,</span> <span class="token string">'famale'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'m'</span><span class="token punctuation">,</span> <span class="token string">'male'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">User</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    name <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">)</span>
    sex <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> choices<span class="token operator">=</span>sex_choices<span class="token punctuation">)</span>

    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span>
        verbose_name <span class="token operator">=</span> <span class="token string">u&quot;用户信息表&quot;</span>
        verbose_name_plural <span class="token operator">=</span> <span class="token string">u&quot;用户信息表&quot;</span>

    <span class="token keyword">def</span> <span class="token function">__unicode__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>name

注：
verbose_name<span class="token punctuation">:</span> 给模型类定义一个可读性的单数模型名称，若果未设置，会自动使用模型的分词形式，例如：UserTest，被转换为user tests
verbose_name_plural<span class="token punctuation">:</span> 指定模型类的复数形式名称，如不指定，Django会自动在模型名称后加一个s 
</code></pre></div><h2 id="七、常用的字段参数"><a href="#七、常用的字段参数" class="header-anchor">#</a> 七、常用的字段参数</h2> <div class="language-sh extra-class"><pre class="language-sh"><code>null：定义是否允许相应的数据库字段为NULL，默认为False
blank：定义字段是否可以为空，null是数据库中的非空约束，blank用于字段的HTML表单验证，即判断用户是否可以不输入数据
choices：定义字段的可选值，二维元素的元组，值1表示实际存储的值，值2表示HTML页面中进行选择时显示的值
default：设定默认值
help_text：HTML页面中输入控件的帮助字符串
primary_key：定义字段是否为主键，（True或False）
unique：是否为字段定义的唯一约束
name <span class="token operator">=</span> models.CharField<span class="token punctuation">(</span>verbose_name<span class="token operator">=</span>u<span class="token string">&quot;用户名&quot;</span>, <span class="token assign-left variable">max_length</span><span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">)</span>    <span class="token comment"># 定义HTML的标签</span>
</code></pre></div><h2 id="八、基本查询"><a href="#八、基本查询" class="header-anchor">#</a> 八、基本查询</h2> <div class="language-py extra-class"><pre class="language-py"><code><span class="token keyword">from</span> app<span class="token punctuation">.</span>models <span class="token keyword">import</span> User
obj <span class="token operator">=</span> User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                 <span class="token comment"># 查询User模型的所有数据</span>
obj <span class="token operator">=</span> User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>ds__day<span class="token operator">=</span><span class="token number">18</span><span class="token punctuation">)</span>    <span class="token comment"># 查询User模型的符合筛选条件的数据集，filter</span>
obj <span class="token operator">=</span> User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>exclude<span class="token punctuation">(</span>ds__day<span class="token operator">=</span><span class="token number">18</span><span class="token punctuation">)</span>   <span class="token comment"># 查询User模型的不符合筛选条件的数据集，exclude</span>
obj <span class="token operator">=</span> User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get<span class="token punctuation">(</span>id__exact<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>      <span class="token comment"># 查询单条ID为1的记录</span>
obj <span class="token operator">=</span> User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">10</span><span class="token punctuation">]</span>            <span class="token comment"># 查询User模型的前10条数据，相当于limit</span>
obj <span class="token operator">=</span> User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">]</span>          <span class="token comment"># 查询User模型的第10到20条数据</span>
obj <span class="token operator">=</span> User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>              <span class="token comment"># 查询User模型的第2条数据（index从0开始记录）</span>
obj <span class="token operator">=</span> User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>order_by<span class="token punctuation">(</span><span class="token string">'ds'</span><span class="token punctuation">)</span>        <span class="token comment"># 查询User模型的所有数据,并按照ds列排序</span>
</code></pre></div><p>筛选条件的格式</p> <div class="language-sh extra-class"><pre class="language-sh"><code>字段名称_谓词         <span class="token comment"># 字段名称+双下划线+谓词</span>
</code></pre></div><p>Django谓词表</p> <table><thead><tr><th>谓词</th> <th>说明</th> <th>示例</th> <th>等价的SQL</th></tr></thead> <tbody><tr><td>exact</td> <td>精确等于</td> <td>.filter(id__exact=1)</td> <td>where id = 1</td></tr> <tr><td>iexact</td> <td>大小写不敏感的等于</td> <td>.filter(st__iexact='you')</td> <td>where upper(st) like 'you'</td></tr> <tr><td>contains</td> <td>模糊匹配</td> <td>.filter(st__contains=&quot;abc&quot;)</td> <td>where st like '%abc%'</td></tr> <tr><td>in</td> <td>包含</td> <td>.filter(id__in=[1,2,3])</td> <td>where id in (1,2,3)</td></tr> <tr><td>gt</td> <td>大于</td> <td>.filter(id__gt=10)</td> <td>where id &gt;10</td></tr> <tr><td>gte</td> <td>大于等于</td> <td>.filter(id__gte=10)</td> <td>where id&gt;=10</td></tr> <tr><td>lt</td> <td>小于</td> <td>.filter(id__lt=10)</td> <td>where id &lt;10</td></tr> <tr><td>lte</td> <td>小于等于</td> <td>.filter(id__lte=10)</td> <td>where id &lt;=10</td></tr> <tr><td>startswith</td> <td>以...开头</td> <td>.filter(st__startswith==&quot;aa&quot;)</td> <td>where st like 'aa%'</td></tr> <tr><td>endswith</td> <td>以...结尾</td> <td>.filter(st__endswith==&quot;aa&quot;)</td> <td>where st like '%aa'</td></tr> <tr><td>range</td> <td>在...范围内</td> <td>.filter(id__range=(1,5))</td> <td>where id between 1 and 5</td></tr> <tr><td>year</td> <td>年</td> <td>.filter(ds__year=2017)</td> <td></td></tr> <tr><td>month</td> <td>月</td> <td>.filter(ds__month=12)</td> <td></td></tr> <tr><td>day</td> <td>日</td> <td>.filter(ds__day=20)</td> <td></td></tr> <tr><td>weekday</td> <td>星期几</td> <td>.filter(ds__weekday=1)</td> <td></td></tr> <tr><td>isnull</td> <td>是否为空</td> <td>.filter(ds__isnull=True)</td> <td>where ds is null</td></tr></tbody></table> <h2 id="九、数据的增删改"><a href="#九、数据的增删改" class="header-anchor">#</a> 九、数据的增删改</h2> <div class="language-py extra-class"><pre class="language-py"><code><span class="token keyword">from</span> app<span class="token punctuation">.</span>models <span class="token keyword">import</span> Test
<span class="token comment"># 存入数据 - 方法一</span>
t <span class="token operator">=</span> Test<span class="token punctuation">(</span><span class="token punctuation">)</span>
t<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'wang'</span>
t<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># 存入数据 - 方法二</span>
t <span class="token operator">=</span> Test<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'Tom'</span><span class="token punctuation">)</span>
t<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># 存入数据 - 方法三</span>
Test<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>create<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'Li'</span><span class="token punctuation">)</span>
<span class="token comment"># 删除id为1的数据</span>
Test<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>id__exact <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>delete<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># 修改id为3的数据</span>
t <span class="token operator">=</span> Test<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span>
t<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># ==============说明=========================</span>
save：用于增加和修改
delete：用于删除记录，既可以用于数据集，也可以用于单条记录
</code></pre></div><h2 id="十、关系操作"><a href="#十、关系操作" class="header-anchor">#</a> 十、关系操作</h2> <p>说明</p> <div class="language-sh extra-class"><pre class="language-sh"><code>account <span class="token operator">=</span> models.OneToOneField<span class="token punctuation">(</span>Account<span class="token punctuation">)</span>         <span class="token comment"># 一对一关系</span>
account <span class="token operator">=</span> models.ForeignKey<span class="token punctuation">(</span>Account<span class="token punctuation">)</span>            <span class="token comment"># 一对多关系(主外键)</span>
account <span class="token operator">=</span> models.MoneyToMoneyField<span class="token punctuation">(</span>Account<span class="token punctuation">)</span>     <span class="token comment"># 多对多关系</span>
account <span class="token operator">=</span> models.OneToOneField<span class="token punctuation">(</span>Account, <span class="token assign-left variable">on_delete</span><span class="token operator">=</span>models.CASCADE<span class="token punctuation">)</span>   <span class="token comment"># on_delete用于被关联的记录删除时，本记录也随之删除</span>
</code></pre></div><p>例子：主外键(一对多)</p> <div class="language-py extra-class"><pre class="language-py"><code><span class="token keyword">class</span> <span class="token class-name">Blog</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    name <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">)</span>
    te <span class="token operator">=</span> models<span class="token punctuation">.</span>ForeignKey<span class="token punctuation">(</span>Entry<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">__unicode__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>name
</code></pre></div><p>数据存储和查询</p> <div class="language-py extra-class"><pre class="language-py"><code>In <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token keyword">from</span> app<span class="token punctuation">.</span>models <span class="token keyword">import</span> Entry<span class="token punctuation">,</span> blog
In <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">:</span> entry1 <span class="token operator">=</span> Entry<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>create<span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">'aa'</span><span class="token punctuation">)</span>
In <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">:</span> entry2 <span class="token operator">=</span> Entry<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>create<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'Max'</span><span class="token punctuation">)</span>
In <span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">:</span> entry3 <span class="token operator">=</span> Entry<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>create<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'carl'</span><span class="token punctuation">)</span>
In <span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">:</span> blog1 <span class="token operator">=</span> blog<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>create<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'aa'</span><span class="token punctuation">,</span>te<span class="token operator">=</span>entry1<span class="token punctuation">)</span>
In <span class="token punctuation">[</span><span class="token number">11</span><span class="token punctuation">]</span><span class="token punctuation">:</span> blog1<span class="token punctuation">.</span>te_id
Out<span class="token punctuation">[</span><span class="token number">11</span><span class="token punctuation">]</span><span class="token punctuation">:</span> 1L
In <span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">]</span><span class="token punctuation">:</span> blog1<span class="token punctuation">.</span>te
Out<span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span>Entry<span class="token punctuation">:</span> aa<span class="token operator">&gt;</span>
In <span class="token punctuation">[</span><span class="token number">13</span><span class="token punctuation">]</span><span class="token punctuation">:</span> entry1<span class="token punctuation">.</span><span class="token builtin">id</span>
Out<span class="token punctuation">[</span><span class="token number">13</span><span class="token punctuation">]</span><span class="token punctuation">:</span> 1L
In <span class="token punctuation">[</span><span class="token number">14</span><span class="token punctuation">]</span><span class="token punctuation">:</span> entry1<span class="token punctuation">.</span>name
Out<span class="token punctuation">[</span><span class="token number">14</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token string">'aa'</span>
In <span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">:</span> entry1<span class="token punctuation">.</span>blog_set<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
Out<span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span>QuerySet <span class="token punctuation">[</span><span class="token operator">&lt;</span>blog<span class="token punctuation">:</span> aa<span class="token operator">&gt;</span><span class="token punctuation">]</span><span class="token operator">&gt;</span>
</code></pre></div><h2 id="十一、类继承"><a href="#十一、类继承" class="header-anchor">#</a> 十一、类继承</h2> <blockquote><ul><li>抽象类继承：父类继承models.Model，但是不会再数据库中生成相应的数据表，子类将父类的列存储在子类的数据表中，用于多个表含有相同字段时，抽象类的定义需要通过模型中的Meta中 abstract = True实现</li> <li>多表继承：父类继承models.Model，父类和子类均在数据库中生成相应的数据表，子类不会将父类的字段存储在子类的数据表中，且可直接引用父类的字段，父类无需定义模型中的Meta中abstract</li> <li>代理模型继承：父类继承models.Model，父类在数据库中生成相应的数据表，子类不生成数据表，只是通过子类的Meta管理父类的数据(例：排序)，子类的定义需要通过模型中的Meta中 proxy = True实现</li></ul></blockquote> <p>抽象类</p> <div class="language-py extra-class"><pre class="language-py"><code><span class="token keyword">class</span> <span class="token class-name">Grap</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>

    name <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>verbose_name<span class="token operator">=</span><span class="token string">u'名称'</span><span class="token punctuation">,</span> max_length<span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">)</span>
    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span>
        <span class="token comment"># 定义为抽象父类</span>
        abstract <span class="token operator">=</span> <span class="token boolean">True</span>


<span class="token keyword">class</span> <span class="token class-name">Square</span><span class="token punctuation">(</span>Grap<span class="token punctuation">)</span><span class="token punctuation">:</span>
    length <span class="token operator">=</span> models<span class="token punctuation">.</span>IntegerField<span class="token punctuation">(</span>verbose_name<span class="token operator">=</span><span class="token string">u'长'</span><span class="token punctuation">)</span>
    width <span class="token operator">=</span> models<span class="token punctuation">.</span>IntegerField<span class="token punctuation">(</span>verbose_name<span class="token operator">=</span><span class="token string">u'宽'</span><span class="token punctuation">)</span>
    height <span class="token operator">=</span> models<span class="token punctuation">.</span>IntegerField<span class="token punctuation">(</span>verbose_name<span class="token operator">=</span><span class="token string">u'高'</span><span class="token punctuation">)</span>

    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span>
        verbose_name <span class="token operator">=</span> <span class="token string">u'正方体'</span>
        verbose_name_plural <span class="token operator">=</span> <span class="token string">u'正方体'</span>

    <span class="token keyword">def</span> <span class="token function">__unicode__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>name
</code></pre></div><p>多表继承</p> <div class="language-py extra-class"><pre class="language-py"><code><span class="token keyword">class</span> <span class="token class-name">GrapOne</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    name <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>verbose_name<span class="token operator">=</span><span class="token string">u'名称'</span><span class="token punctuation">,</span> max_length<span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">SquareOne</span><span class="token punctuation">(</span>GrapOne<span class="token punctuation">)</span><span class="token punctuation">:</span>
    length <span class="token operator">=</span> models<span class="token punctuation">.</span>IntegerField<span class="token punctuation">(</span>verbose_name<span class="token operator">=</span><span class="token string">u'长'</span><span class="token punctuation">)</span>
    width <span class="token operator">=</span> models<span class="token punctuation">.</span>IntegerField<span class="token punctuation">(</span>verbose_name<span class="token operator">=</span><span class="token string">u'宽'</span><span class="token punctuation">)</span>
    height <span class="token operator">=</span> models<span class="token punctuation">.</span>IntegerField<span class="token punctuation">(</span>verbose_name<span class="token operator">=</span><span class="token string">u'高'</span><span class="token punctuation">)</span>

    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span>
        verbose_name <span class="token operator">=</span> <span class="token string">u'正方体'</span>
        verbose_name_plural <span class="token operator">=</span> <span class="token string">u'正方体'</span>

    <span class="token keyword">def</span> <span class="token function">__unicode__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>name
</code></pre></div><p>代理模型继承</p> <div class="language-py extra-class"><pre class="language-py"><code><span class="token keyword">class</span> <span class="token class-name">GrapTwo</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    name <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>verbose_name<span class="token operator">=</span><span class="token string">u'名称'</span><span class="token punctuation">,</span> max_length<span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">)</span>
    length <span class="token operator">=</span> models<span class="token punctuation">.</span>IntegerField<span class="token punctuation">(</span>verbose_name<span class="token operator">=</span><span class="token string">u'长'</span><span class="token punctuation">)</span>
    width <span class="token operator">=</span> models<span class="token punctuation">.</span>IntegerField<span class="token punctuation">(</span>verbose_name<span class="token operator">=</span><span class="token string">u'宽'</span><span class="token punctuation">)</span>
    height <span class="token operator">=</span> models<span class="token punctuation">.</span>IntegerField<span class="token punctuation">(</span>verbose_name<span class="token operator">=</span><span class="token string">u'高'</span><span class="token punctuation">)</span>


<span class="token keyword">class</span> <span class="token class-name">SquareTwo</span><span class="token punctuation">(</span>GrapTwo<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span>
        proxy <span class="token operator">=</span> <span class="token boolean">True</span>
        ordering <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'length'</span><span class="token punctuation">]</span>
        verbose_name <span class="token operator">=</span> <span class="token string">u'正方体'</span>
        verbose_name_plural <span class="token operator">=</span> <span class="token string">u'正方体'</span>

    <span class="token keyword">def</span> <span class="token function">__unicode__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>name
</code></pre></div><h2 id="十二、模板-过滤器"><a href="#十二、模板-过滤器" class="header-anchor">#</a> 十二、模板 - 过滤器</h2> <blockquote><p>模板中放置在变量后用于控制变量的显示格式</p></blockquote> <p>格式</p> <div class="language- extra-class"><pre class="language-text"><code>{{ 变量 | 过滤器 }}
</code></pre></div><p>常用的过滤器</p> <table><thead><tr><th>过滤器</th> <th>说明</th> <th>例子</th></tr></thead> <tbody><tr><td>default</td> <td>如果值不存在，则指定默认值</td> <td><code></code></td></tr> <tr><td>floatformat</td> <td>转换为指定位数的小数，默认保留1位</td> <td><code></code></td></tr> <tr><td>default_if_none</td> <td>如果值为None，则指定默认值</td> <td><code></code></td></tr> <tr><td>lower</td> <td>字符串转换为小写</td> <td><code></code></td></tr> <tr><td>upper</td> <td>字符串转换为大写</td> <td><code></code></td></tr> <tr><td>date</td> <td>格式化日期</td> <td><code></code></td></tr> <tr><td>change_date</td> <td>格式化日期</td> <td><code></code></td></tr></tbody></table> <h2 id="十三、admin管理模板"><a href="#十三、admin管理模板" class="header-anchor">#</a> 十三、Admin管理模板</h2> <p>修改admin管理页面标题</p> <div class="language-py extra-class"><pre class="language-py"><code><span class="token comment"># 修改admin.py</span>
<span class="token keyword">from</span> django<span class="token punctuation">.</span>contrib <span class="token keyword">import</span> admin

<span class="token keyword">class</span> <span class="token class-name">MyAdminSite</span><span class="token punctuation">(</span>admin<span class="token punctuation">.</span>AdminSite<span class="token punctuation">)</span><span class="token punctuation">:</span>
    site_header <span class="token operator">=</span> <span class="token string">'测试网站'</span>            <span class="token comment"># 设置标题内容</span>
    site_title <span class="token operator">=</span> <span class="token string">'测试'</span>                <span class="token comment"># 设置浏览器窗口显示的页面名称</span>

admin_site <span class="token operator">=</span> MyAdminSite<span class="token punctuation">(</span><span class="token punctuation">)</span>              <span class="token comment"># 实例化子类</span>
admin_site<span class="token punctuation">.</span>register<span class="token punctuation">(</span>User<span class="token punctuation">,</span> UserAdmins<span class="token punctuation">)</span>   <span class="token comment"># 用子类实例注册需要管理的模板类</span>

<span class="token comment"># 修改URL.py</span>
<span class="token keyword">from</span> app<span class="token punctuation">.</span>admin <span class="token keyword">import</span> admin_site

urlpatterns <span class="token operator">=</span> <span class="token punctuation">[</span>
    url<span class="token punctuation">(</span><span class="token string">r'^admin/'</span><span class="token punctuation">,</span> admin_site<span class="token punctuation">.</span>urls<span class="token punctuation">)</span><span class="token punctuation">,</span>
    url<span class="token punctuation">(</span><span class="token string">r'^app/'</span><span class="token punctuation">,</span> include<span class="token punctuation">(</span><span class="token string">'app.urls'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
</code></pre></div><h2 id="十四、auth模块"><a href="#十四、auth模块" class="header-anchor">#</a> 十四、auth模块</h2> <blockquote><ul><li>auth模块是Django提供的标准权限管理系统，可以提供用户身份认证、用户组和权限管理</li></ul></blockquote> <p>用户操作</p> <div class="language-py extra-class"><pre class="language-py"><code><span class="token comment"># 新增用户 - 用户密码通过hash值存储，不存储明文</span>
<span class="token keyword">from</span> django<span class="token punctuation">.</span>contrib<span class="token punctuation">.</span>auth<span class="token punctuation">.</span>models <span class="token keyword">import</span> User
user <span class="token operator">=</span> User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>create_user<span class="token punctuation">(</span>username<span class="token punctuation">,</span> email<span class="token punctuation">,</span> password<span class="token punctuation">)</span>
user<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># 认证用户 - 认证用户的密码是否有效，如有效，则返回用户的User对象，无效则返回None</span>
<span class="token keyword">from</span> django<span class="token punctuation">.</span>contrib<span class="token punctuation">.</span>auth <span class="token keyword">import</span> authenticate
user <span class="token operator">=</span> authenticate<span class="token punctuation">(</span>username<span class="token operator">=</span>username<span class="token punctuation">,</span> password<span class="token operator">=</span>password<span class="token punctuation">)</span>
<span class="token comment"># 修改密码（set_password）,需配合authenticate使用</span>
user <span class="token operator">=</span> auth<span class="token punctuation">.</span>authenticate<span class="token punctuation">(</span>username<span class="token operator">=</span>username<span class="token punctuation">,</span> password<span class="token operator">=</span>old_password<span class="token punctuation">)</span>
<span class="token keyword">if</span> user <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
    user<span class="token punctuation">.</span>set_password<span class="token punctuation">(</span>new_password<span class="token punctuation">)</span>
    user<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># 登陆 - login向session中添加SESSION_KEY, 便于对用户进行跟踪，login向session中添加SESSION_KEY, 便于对用户进行跟踪</span>
<span class="token keyword">from</span> django<span class="token punctuation">.</span>contrib<span class="token punctuation">.</span>auth <span class="token keyword">import</span> login
user <span class="token operator">=</span> authenticate<span class="token punctuation">(</span>username<span class="token operator">=</span>username<span class="token punctuation">,</span> password<span class="token operator">=</span>password<span class="token punctuation">)</span>
<span class="token keyword">if</span> user <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> user<span class="token punctuation">.</span>is_active<span class="token punctuation">:</span>
        login<span class="token punctuation">(</span>request<span class="token punctuation">,</span> user<span class="token punctuation">)</span>
<span class="token comment"># 退出登陆 - logout会移除request中的user信息, 并刷新session</span>
<span class="token keyword">from</span> django<span class="token punctuation">.</span>contrib<span class="token punctuation">.</span>auth <span class="token keyword">import</span> logout
<span class="token keyword">def</span> <span class="token function">logout_view</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    logout<span class="token punctuation">(</span>request<span class="token punctuation">)</span>
<span class="token comment"># 只允许登录的用户访问 - @login_required修饰器修饰的view函数会先通过session key检查是否登录, 已登录用户可以正常的执行操作, 未登录用户将被重定向到login_url指定的位置，若未指定login_url参数, 则重定向到settings.LOGIN_URL</span>
<span class="token keyword">from</span> django<span class="token punctuation">.</span>contrib<span class="token punctuation">.</span>auth<span class="token punctuation">.</span>decorators <span class="token keyword">import</span> login_required
<span class="token decorator annotation punctuation">@login_required</span><span class="token punctuation">(</span>login_url<span class="token operator">=</span><span class="token string">'/accounts/login/'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">my_view</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre></div><h2 id="十五、其他查询"><a href="#十五、其他查询" class="header-anchor">#</a> 十五、其他查询</h2> <p>values和values_list的区别，以及annotate计算</p> <div class="language-py extra-class"><pre class="language-py"><code>In <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token keyword">from</span> app<span class="token punctuation">.</span>models <span class="token keyword">import</span> User
In <span class="token punctuation">[</span><span class="token number">24</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token keyword">from</span> django<span class="token punctuation">.</span>db<span class="token punctuation">.</span>models <span class="token keyword">import</span> Sum
In <span class="token punctuation">[</span><span class="token number">25</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token keyword">from</span> django<span class="token punctuation">.</span>db<span class="token punctuation">.</span>models <span class="token keyword">import</span> Count

In <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">:</span> users <span class="token operator">=</span>  User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">)</span>
In <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">:</span> users
Out<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span>QuerySet <span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token string">'id'</span><span class="token punctuation">:</span> 1L<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">'id'</span><span class="token punctuation">:</span> 2L<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">'id'</span><span class="token punctuation">:</span> 3L<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">'id'</span><span class="token punctuation">:</span> 4L<span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token operator">&gt;</span>

In <span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">:</span> users_1 <span class="token operator">=</span>  User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>values_list<span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">)</span>
In <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">:</span> users_1
Out<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span>QuerySet <span class="token punctuation">[</span><span class="token punctuation">(</span>1L<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>2L<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>3L<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>4L<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">&gt;</span>

In <span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">:</span> users_2 <span class="token operator">=</span>  User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>values_list<span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">,</span>flat<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
In <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">:</span> users_2
Out<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span>QuerySet <span class="token punctuation">[</span>1L<span class="token punctuation">,</span> 2L<span class="token punctuation">,</span> 3L<span class="token punctuation">,</span> 4L<span class="token punctuation">]</span><span class="token operator">&gt;</span>

In <span class="token punctuation">[</span><span class="token number">19</span><span class="token punctuation">]</span><span class="token punctuation">:</span> users_1 <span class="token operator">=</span>  User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>values_list<span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>
In <span class="token punctuation">[</span><span class="token number">22</span><span class="token punctuation">]</span><span class="token punctuation">:</span> users_1
Out<span class="token punctuation">[</span><span class="token number">22</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>1L<span class="token punctuation">,</span><span class="token punctuation">)</span>

In <span class="token punctuation">[</span><span class="token number">46</span><span class="token punctuation">]</span><span class="token punctuation">:</span> num <span class="token operator">=</span> User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>values_list<span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">,</span> <span class="token string">'sex'</span><span class="token punctuation">)</span>
In <span class="token punctuation">[</span><span class="token number">47</span><span class="token punctuation">]</span><span class="token punctuation">:</span> num
Out<span class="token punctuation">[</span><span class="token number">47</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span>QuerySet <span class="token punctuation">[</span><span class="token punctuation">(</span>1L<span class="token punctuation">,</span> <span class="token string">u'm'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>2L<span class="token punctuation">,</span> <span class="token string">u'f'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>3L<span class="token punctuation">,</span> <span class="token string">u'm'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>4L<span class="token punctuation">,</span> <span class="token string">u'm'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">&gt;</span>

In <span class="token punctuation">[</span><span class="token number">40</span><span class="token punctuation">]</span><span class="token punctuation">:</span>  num <span class="token operator">=</span> User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>values_list<span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>annotate<span class="token punctuation">(</span>Sum<span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>Count<span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">)</span>
In <span class="token punctuation">[</span><span class="token number">41</span><span class="token punctuation">]</span><span class="token punctuation">:</span> num
Out<span class="token punctuation">[</span><span class="token number">41</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span>QuerySet <span class="token punctuation">[</span><span class="token punctuation">(</span>1L<span class="token punctuation">,</span> Decimal<span class="token punctuation">(</span><span class="token string">'1'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>2L<span class="token punctuation">,</span> Decimal<span class="token punctuation">(</span><span class="token string">'2'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>3L<span class="token punctuation">,</span> Decimal<span class="token punctuation">(</span><span class="token string">'3'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>4L<span class="token punctuation">,</span> Decimal<span class="token punctuation">(</span><span class="token string">'4'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">&gt;</span>

<span class="token comment"># ==============说明===========</span>
values方法用于获取number字段的字典列表。
values_list用于获取number的元组列表。
values_list方法加个参数flat<span class="token operator">=</span><span class="token boolean">True</span>用于获取number的值列表。
</code></pre></div><hr> <h2 id="说明一、django支持的数据库"><a href="#说明一、django支持的数据库" class="header-anchor">#</a> 说明一、Django支持的数据库</h2> <ul><li><a href="http://www.postgresql.org/" target="_blank" rel="noopener noreferrer">PostgreSQL<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="http://www.sqlite.org/" target="_blank" rel="noopener noreferrer">SQLLite 3<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="http://www.mysql.com/" target="_blank" rel="noopener noreferrer">MySQL<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="http://www.oracle.com/" target="_blank" rel="noopener noreferrer">Oracle<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <h2 id="说明二、正则表达式"><a href="#说明二、正则表达式" class="header-anchor">#</a> 说明二、正则表达式</h2> <table><thead><tr><th>符号</th> <th>匹配</th></tr></thead> <tbody><tr><td>. (dot)</td> <td>任意单一字符</td></tr> <tr><td>\d</td> <td>任意一位数字</td></tr> <tr><td>[A-Z]</td> <td>A 到 Z中任意一个字符（大写）</td></tr> <tr><td>[a-z]</td> <td>a 到 z中任意一个字符（小写）</td></tr> <tr><td>[A-Za-z]</td> <td>a 到 z中任意一个字符（不区分大小写）</td></tr> <tr><td>+</td> <td>匹配一个或更多 (例如, \d+ 匹配一个或 多个数字字符)</td></tr> <tr><td>[^/]+</td> <td>一个或多个不为‘/’的字符</td></tr> <tr><td>*</td> <td>零个或一个之前的表达式（例如：\d? 匹配零个或一个数字）</td></tr> <tr><td>*</td> <td>匹配0个或更多 (例如, \d* 匹配0个 或更多数字字符)</td></tr> <tr><td>{1,3}</td> <td>介于一个和三个（包含）之前的表达式（例如，\d{1,3}匹配一个或两个或三个数字）</td></tr></tbody></table> <h2 id="widthratio"><a href="#widthratio" class="header-anchor">#</a> widthratio</h2> <blockquote><p>widthratio 通常用来显示图表，比例时用的，一个数字占了多少百分比等</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>乘法 A*B: {% widthratio A 1 B %}
除法 A/B: {% widthratio A B 1 %}

计算 A^2: {% widthratio A 1 A %}
计算 (A+B)^2: {% widthratio A|add:B 1 A|add:B %}
计算 (A+B) * (C+D): {% widthratio A|add:B 1 C|add:D %}
</code></pre></div><h2 id="清理cache缓存-django-cache"><a href="#清理cache缓存-django-cache" class="header-anchor">#</a> 清理cache缓存(Django Cache)</h2> <div class="language-sh extra-class"><pre class="language-sh"><code>$ python manage.py shell
<span class="token operator">&gt;&gt;</span> from django.core.cache <span class="token function">import</span> cache
<span class="token operator">&gt;&gt;</span> cache.clear<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="cgi"><a href="#cgi" class="header-anchor">#</a> CGI</h2> <p>CGI(Common Gateway Interface) 是外部应用程序（CGI程序）与WEB服务器之间的接口标准，是在CGI程序和Web服务器之间传递信息的过程。CGI规范允许Web服务器执行外部程序，并将它们的输出发送给Web浏览器，CGI将Web的一组简单的静态超媒体文档变成一个完整的新的交互式媒体。</p> <h2 id="处理步骤编辑"><a href="#处理步骤编辑" class="header-anchor">#</a> 处理步骤编辑</h2> <ol><li>通过Internet把用户请求送到web服务器</li> <li>web服务器接收用户请求并交给CGI程序处理</li> <li>CGI程序把处理结果传送给web服务器</li> <li>web服务器把结果送回到用户</li></ol> <h2 id="mvc-设计模式"><a href="#mvc-设计模式" class="header-anchor">#</a> MVC 设计模式</h2> <ul><li>models.py (the database tables)</li></ul> <blockquote><p>主要用一个 Python 类来描述数据表。 称为 模型(model) 。 运用这个类，你可以通过简单的 Python 的代码来创建、检索、更新、删除 数据库中的记录而无需写一条又一条的SQL语句</p></blockquote> <div class="language-py extra-class"><pre class="language-py"><code><span class="token keyword">from</span> django<span class="token punctuation">.</span>db <span class="token keyword">import</span> models

<span class="token keyword">class</span> <span class="token class-name">Book</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    name <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">50</span><span class="token punctuation">)</span>
    pub_date <span class="token operator">=</span> models<span class="token punctuation">.</span>DateField<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><ul><li>views.py (the business logic)</li></ul> <blockquote><p>包含了页面的业务逻辑。 latest_books()函数叫做视图</p></blockquote> <div class="language-py extra-class"><pre class="language-py"><code><span class="token keyword">from</span> django<span class="token punctuation">.</span>shortcuts <span class="token keyword">import</span> render_to_response
<span class="token keyword">from</span> models <span class="token keyword">import</span> Book

<span class="token comment"># latest_books()函数叫做视图</span>
<span class="token keyword">def</span> <span class="token function">latest_books</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    book_list <span class="token operator">=</span> Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>order_by<span class="token punctuation">(</span><span class="token string">'-pub_date'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">10</span><span class="token punctuation">]</span>
    <span class="token keyword">return</span> render_to_response<span class="token punctuation">(</span><span class="token string">'latest_books.html'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">'book_list'</span><span class="token punctuation">:</span> book_list<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><ul><li>urls.py (the URL configuration)</li></ul> <blockquote><p>指出了什么样的 URL 调用什么的视图。 在这个例子中 /latest/ URL 将会调用 latest_books() 这个函数。 换句话说，如果你的域名是example.com，任何人浏览网址http://example.com/latest/将会调用latest_books()这个函数</p></blockquote> <div class="language-py extra-class"><pre class="language-py"><code><span class="token keyword">from</span> django<span class="token punctuation">.</span>conf<span class="token punctuation">.</span>urls<span class="token punctuation">.</span>defaults <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">import</span> views

urlpatterns <span class="token operator">=</span> patterns<span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token string">r'^latest/$'</span><span class="token punctuation">,</span> views<span class="token punctuation">.</span>latest_books<span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>
</code></pre></div><ul><li>latest_books.html (the template)</li></ul> <blockquote><p>html 模板，它描述了这个页面的设计是如何的。 使用带基本逻辑声明的模板语言，如{% for book in book_list %}</p></blockquote> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Books<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>Books<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span>
{% for book in book_list %}
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>{{ book.name }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
{% endfor %}
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h2 id="部署django"><a href="#部署django" class="header-anchor">#</a> 部署Django</h2> <p><a href="https://uwsgi-docs.readthedocs.io/en/latest/" target="_blank" rel="noopener noreferrer">uwsgi官方文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="一、创建项目"><a href="#一、创建项目" class="header-anchor">#</a> 一、创建项目</h3> <div class="language-sh extra-class"><pre class="language-sh"><code>$ django-admin.py startproject test_pro     <span class="token comment"># 创建项目</span>
$ <span class="token function">chmod</span> +x django-admin.py      <span class="token comment"># 如果权限拒绝，运行此命令</span>
$ django-admin startapp app1    <span class="token comment"># 创建应用</span>
$ python manage.py runserver    <span class="token comment"># 启动服务，默认访问127.0.0.1:8000/url/</span>
<span class="token comment"># 项目存放位置最好是根目录(root)之外的位置，因为放到根目录有使人通过网络看到源代码的风险</span>
</code></pre></div><ul><li>uwsgi.ini</li></ul> <div class="language- extra-class"><pre class="language-text"><code># plugins = python
py-autoreload = 2
</code></pre></div><h3 id="二、python的两种安装组件的方法-通常两种都需要安装"><a href="#二、python的两种安装组件的方法-通常两种都需要安装" class="header-anchor">#</a> 二、python的两种安装组件的方法(通常两种都需要安装)</h3> <div class="language- extra-class"><pre class="language-text"><code>easy_install ：出现较早
pip ：pip是easy_install的改进版，提供了更好的提示信息
</code></pre></div><h3 id="三、web服务器"><a href="#三、web服务器" class="header-anchor">#</a> 三、WEB服务器</h3> <div class="language- extra-class"><pre class="language-text"><code>web服务器是连接用户浏览器与python服务端程序的中间节点，目前主流的web服务器包括：Nginx、Apache、Lighthttpd、IIS等
WSGI：全称 Web Server Gateway Interface，wsgi是将python服务端程序连接到web服务器的通用协议，uwsgi和apache的mod_wsgi都是独立的wsgi程序。wsgi用于为python语言定义web服务器和服务器端程序的通用接口规范。
</code></pre></div><h3 id="四、wsgi的接口分为两个"><a href="#四、wsgi的接口分为两个" class="header-anchor">#</a> 四、WSGI的接口分为两个</h3> <ul><li>与web服务器的接口</li> <li>与服务器端程序的接口</li></ul> <h3 id="五、nginx"><a href="#五、nginx" class="header-anchor">#</a> 五、Nginx</h3> <ul><li>Nginx是由俄罗斯工程师开发的一个高性能HTTP和反向代理服务器</li> <li>优点：运行稳定、配置简单、资源消耗低</li></ul> <p>Nginx的相关文件路径：</p> <div class="language-sh extra-class"><pre class="language-sh"><code>/etc/nginx/nginx.conf           <span class="token comment"># 全局配置文件</span>
/var/log/nginx/access.log-日期   <span class="token comment"># 访问日志文件</span>
/var/log/nginx/error.log-日期    <span class="token comment"># 错误日志文件</span>
</code></pre></div><p>Nginx配置文件</p> <div class="language-sh extra-class"><pre class="language-sh"><code>$ <span class="token function">vim</span> /etc/nginx/nginx.conf
user  nginx<span class="token punctuation">;</span>                <span class="token comment"># 定义运行Nginx的用户</span>
worker_processes  <span class="token number">1</span><span class="token punctuation">;</span>        <span class="token comment"># Nginx的进行数，应设置与系统CPU数量相等的数值</span>

error_log  /var/log/nginx/error.log warn<span class="token punctuation">;</span>   <span class="token comment"># 错误日志文件路径</span>
pid        /var/run/nginx.pid<span class="token punctuation">;</span>              <span class="token comment">#</span>

events <span class="token punctuation">{</span>
    worker_connections  <span class="token number">1024</span><span class="token punctuation">;</span>               <span class="token comment"># 每个Nginx进行允许的最大客户端连接数</span>
<span class="token punctuation">}</span>

http <span class="token punctuation">{</span>
    include       /etc/nginx/mime.types<span class="token punctuation">;</span>        <span class="token comment">#</span>
    default_type  application/octet-stream<span class="token punctuation">;</span>

    log_format  main  <span class="token string">'<span class="token variable">$remote_addr</span> - <span class="token variable">$remote_user</span> [<span class="token variable">$time_local</span>] &quot;<span class="token variable">$request</span>&quot; '</span>
                      <span class="token string">'<span class="token variable">$status</span> <span class="token variable">$body_bytes_sent</span> &quot;<span class="token variable">$http_referer</span>&quot; '</span>
                      <span class="token string">'&quot;<span class="token variable">$http_user_agent</span>&quot; &quot;<span class="token variable">$http_x_forwarded_for</span>&quot;'</span><span class="token punctuation">;</span>

    access_log  /var/log/nginx/access.log  main<span class="token punctuation">;</span>    <span class="token comment"># 访问日志文件路径名</span>
    sendfile        on<span class="token punctuation">;</span>             <span class="token comment"># 是否允许文件上传</span>
    <span class="token comment">#tcp_nopush     on;             # 防止网络阻塞</span>
    keepalive_timeout  <span class="token number">65</span><span class="token punctuation">;</span>          <span class="token comment"># 允许客户端长连接最大秒数</span>
    <span class="token comment">#gzip  on;</span>

    server <span class="token punctuation">{</span>
        client_max_body_size 20M<span class="token punctuation">;</span>       <span class="token comment"># nginx默认上传文件的上限是1M，修改为上限20M</span>
    	listen       port<span class="token punctuation">;</span>              <span class="token comment"># 配置站点监听的端口</span>
    	server_name  IP地址<span class="token punctuation">;</span>             <span class="token comment"># 站点监听的IP地址，可设置问localhost或者真实的IP地址</span>
    	<span class="token comment">#charset koi8-r;</span>

    	access_log  /data/项目名/logs/data.access.log  main<span class="token punctuation">;</span>
    	error_log   /data/项目名/logs/data.error.log<span class="token punctuation">;</span>

        <span class="token comment"># location用于配置URL的转发接口</span>
    	location /static/ <span class="token punctuation">{</span>
        	root   /data/项目名<span class="token punctuation">;</span>
        	index  index.html index.htm<span class="token punctuation">;</span>
    	<span class="token punctuation">}</span>

    	location /项目名/ <span class="token punctuation">{</span>
        	rewrite <span class="token string">&quot;^/项目名/(.*)$&quot;</span> /<span class="token variable">$1</span> last<span class="token punctuation">;</span>
    	<span class="token punctuation">}</span>

    	location / <span class="token punctuation">{</span>
        	uwsgi_pass host:port<span class="token punctuation">;</span>
                include uwsgi_params<span class="token punctuation">;</span>
    	<span class="token punctuation">}</span>

    	location /admin/ <span class="token punctuation">{</span>
        	uwsgi_pass <span class="token number">127.0</span>.0.1:8078<span class="token punctuation">;</span>
        	include uwsgi_params<span class="token punctuation">;</span>
    	<span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    include /etc/nginx/conf.d/*.conf<span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre></div><h3 id="六、uwsgi"><a href="#六、uwsgi" class="header-anchor">#</a> 六、uWSGI</h3> <p>安装</p> <div class="language-sh extra-class"><pre class="language-sh"><code>pip <span class="token function">install</span> uwsgi       <span class="token comment"># 安装</span>
uwsgi  uwsgi.ini        <span class="token comment"># 启动uwsgi时，直接指定uwsgi.ini即可</span>
</code></pre></div><p>编辑uWSGI.ini文件</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token punctuation">[</span>uwsgi<span class="token punctuation">]</span>
socket <span class="token operator">=</span> host:port     <span class="token comment"># 以WSGI的socket方式运行，并指定链接地址和端口    </span>
master <span class="token operator">=</span> <span class="token boolean">true</span>
processes <span class="token operator">=</span> <span class="token number">4</span>               <span class="token comment"># 指定服务器端程序的进程数</span>

basedir <span class="token operator">=</span> /data/项目名       <span class="token comment">#</span>
chdir <span class="token operator">=</span> %<span class="token punctuation">(</span>basedir<span class="token punctuation">)</span>          <span class="token comment"># 指定uWSGI启动后的当前目录</span>
wsgi-file <span class="token operator">=</span> common/wsgi.py  <span class="token comment"># 指定服务器端的程序名</span>

uid <span class="token operator">=</span> root                  <span class="token comment"># 指定用户隐形uWSGI的Linux用户ID</span>
gid <span class="token operator">=</span> root

pidfile <span class="token operator">=</span> %<span class="token punctuation">(</span>basedir<span class="token punctuation">)</span>/logs/uwsgi-master.pid
daemonize <span class="token operator">=</span> %<span class="token punctuation">(</span>basedir<span class="token punctuation">)</span>/logs/uwsgi-daemonize.log

<span class="token comment"># plugins = python</span>
py-autoreload <span class="token operator">=</span> <span class="token number">2</span>
</code></pre></div><h2 id="django字段类型清单"><a href="#django字段类型清单" class="header-anchor">#</a> Django字段类型清单</h2> <blockquote><p>清单为网上复制的内容，未校验</p></blockquote> <table><thead><tr><th>字段</th> <th>说明</th></tr></thead> <tbody><tr><td>AutoField</td> <td>自动递增的整型字段，通常不需要指定</td></tr> <tr><td>BooleanField</td> <td>布尔字段</td></tr> <tr><td>CharField</td> <td>字符串字段，单行输入，必填参数(max_length)</td></tr> <tr><td>TextField</td> <td>文本字段，容量大，多行编辑框</td></tr> <tr><td>CommaSeparatedIntegerField</td> <td>存放逗号分隔的整数值，必填参数(max_length)</td></tr> <tr><td>DateField</td> <td>日期字段，auto_now（对象保存时间）,auto_now_add（对象创建时间）</td></tr> <tr><td>DateTimeField</td> <td>类似DateField，支持相同的选项</td></tr> <tr><td>EmailField</td> <td>带有Email合法性的CharField</td></tr> <tr><td>FileField</td> <td>文件上传字段，详情如下</td></tr> <tr><td>FilePathField</td> <td>选择指定目录按照限定规则选择文件，详情如下</td></tr> <tr><td>ImageField</td> <td>图片上传字段，可选参数(height_field:高度，width_field:宽度)</td></tr> <tr><td>FloatFIeld</td> <td>浮点型，必填参数(max_digits：除小数点和符号外的总位数，decimal_places：小数点位数)</td></tr> <tr><td>IntegerFie</td> <td>整数字段</td></tr> <tr><td>SmallIntegerField</td> <td>小整型字段</td></tr> <tr><td>PositiveIntegerField</td> <td>整数字段，且非负数</td></tr> <tr><td>PositiveSmallIntegerField</td> <td>整数小整型字段</td></tr> <tr><td>IPAddressField</td> <td>字符串类型的IP地址</td></tr> <tr><td>NullBooleanField</td> <td>布尔类型，但是允许NULL作为其中一个选项（相当于BooleanField加 null=True）</td></tr> <tr><td>PhoneNumberField</td> <td>合法美国风格的电话号码的CharField(格式：XXX-XXX-XXXX)</td></tr> <tr><td>SlugField</td> <td>只包含字母、数字、下划线和连字符，通常用于URLs</td></tr> <tr><td>TimeField</td> <td>时间字段</td></tr> <tr><td>URLField</td> <td>用于保存URL</td></tr> <tr><td>XMLField</td> <td>XML字符字段，校验值是否为合法XML的TextField，必填参数（schema_path：校验文本的 RelaxNG schema 的文件系统路径）</td></tr></tbody></table> <h2 id="field选项"><a href="#field选项" class="header-anchor">#</a> Field选项</h2> <ul><li>null ：缺省设置为false，通常不将其用于字符型字段上，字符型字段如果没有值会返回空字符串。</li> <li>blank：该字段是否可以为空。如果为假，则必须有值</li> <li>choices：一个用来选择值的2维元组。第一个值是实际存储的值，第二个用来方便进行选择。如SEX_CHOICES= ((‘F’,'Female’),(‘M’,'Male’),)</li> <li>core：db_column，db_index 如果为真将为此字段创建索引</li> <li>default：设定缺省值</li> <li>editable：如果为假，admin模式下将不能改写。缺省为真</li> <li>help_text：admin模式下帮助文档</li> <li>primary_key：设置主键，如果没有设置django创建表时会自动加上</li> <li>radio_admin：用于admin模式下将select转换为radio显示。只用于ForeignKey或者设置了choices</li> <li>unique：数据唯一</li> <li>unique_for_date：日期唯一，如下例中系统将不允许title和pub_date两个都相同的数据重复出现</li> <li>title = meta.CharField(maxlength=30,unique_for_date=’pub_date’)</li> <li>unique_for_month / unique_for_year：用法同上</li> <li>validator_list：有效性检查。非有效产生 django.core.validators.ValidationError 错误</li></ul> <h2 id="oauth-第三方登录"><a href="#oauth-第三方登录" class="header-anchor">#</a> OAuth 第三方登录</h2> <ul><li><a href="http://www.ruanyifeng.com/blog/2014/05/oauth_2_0.html" target="_blank" rel="noopener noreferrer">理解OAuth 2.0<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://shenxgan.gitbooks.io/django/content/publish/2015-08-10-django-oauth-login.html" target="_blank" rel="noopener noreferrer">第三方账号登录<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <h3 id="一、oauth-2-0的理解"><a href="#一、oauth-2-0的理解" class="header-anchor">#</a> 一、OAuth 2.0的理解</h3> <blockquote><p>摘自<a href="https://shenxgan.gitbooks.io/django/content/publish/2015-08-10-django-oauth-login.html" target="_blank" rel="noopener noreferrer">第三方账号登录<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></blockquote> <ol><li>点击第三方登录的按钮，发送请求。比如登录页面上的第三方图标</li> <li>用户输入了第三方的登录名和密码</li> <li>在第 2 步的时候，第三方会返回 code，此步就是通过这个 code 去获取 access token</li> <li>第三方确认无误，返回 access token</li> <li>根据获取的 access token 去获取用户的基本信息</li> <li>第三方确认无误，返回用户信息</li></ol> <h3 id="二、django实现"><a href="#二、django实现" class="header-anchor">#</a> 二、Django实现</h3> <h4 id="_1、申请github的client-id和client-secret"><a href="#_1、申请github的client-id和client-secret" class="header-anchor">#</a> 1、申请github的Client ID和Client Secret</h4> <ol><li>登录github</li></ol> <ul><li>setting</li> <li>Developer settings</li> <li>new auth app</li> <li>填写对应的信息 -&gt; register applocation</li> <li>注册成功后会返回Client ID和Client Secret</li></ul> <h4 id="_2、获取code"><a href="#_2、获取code" class="header-anchor">#</a> 2、获取code</h4> <blockquote><p>github_client_id为申请的client_id,redirect_url为申请是填写的redirect_url</p></blockquote> <div class="language-py extra-class"><pre class="language-py"><code><span class="token keyword">def</span> <span class="token function">ReLogin</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">'''
    第三方登录 - 授权码模式
    客户端申请认证的URI，通过HttpResponseRedirect(url)使服务器回应客户端带code的URI
    :param request: 
    :return: 
    '''</span>
    params <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'client_id'</span><span class="token punctuation">:</span> github_client_id<span class="token punctuation">,</span>
              <span class="token string">'response_type'</span><span class="token punctuation">:</span> <span class="token string">'code'</span><span class="token punctuation">,</span>
              <span class="token string">'redirect_uri'</span><span class="token punctuation">:</span> redirect_url<span class="token punctuation">,</span>
              <span class="token string">'state'</span><span class="token punctuation">:</span> <span class="token string">'xyz'</span><span class="token punctuation">}</span>
    url <span class="token operator">=</span> <span class="token string">'%s?%s'</span> <span class="token operator">%</span> <span class="token punctuation">(</span><span class="token string">'https://github.com/login/oauth/authorize'</span><span class="token punctuation">,</span> urllib<span class="token punctuation">.</span>urlencode<span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> HttpResponseRedirect<span class="token punctuation">(</span>url<span class="token punctuation">)</span>
</code></pre></div><h4 id="_3、获取access-token，并通过access-token访问服务端数据"><a href="#_3、获取access-token，并通过access-token访问服务端数据" class="header-anchor">#</a> 3、获取access_token，并通过access_token访问服务端数据</h4> <div class="language-py extra-class"><pre class="language-py"><code><span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">'''
    获取服务端回应的code和state
    :param request: 
    :return: 
    '''</span>
    request_code <span class="token operator">=</span> request<span class="token punctuation">.</span>GET<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'code'</span><span class="token punctuation">)</span>
    state <span class="token operator">=</span> request<span class="token punctuation">.</span>GET<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'state'</span><span class="token punctuation">)</span> <span class="token keyword">or</span> <span class="token string">'/'</span>
    <span class="token keyword">print</span> request_code<span class="token punctuation">,</span> state

    <span class="token comment"># 通过传入code，获取access_token</span>
    url <span class="token operator">=</span> <span class="token string">'https://github.com/login/oauth/access_token'</span>
    data <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token string">'grant_type'</span><span class="token punctuation">:</span> <span class="token string">'authorization_code'</span><span class="token punctuation">,</span>
        <span class="token string">'client_id'</span><span class="token punctuation">:</span> github_client_id<span class="token punctuation">,</span>
        <span class="token string">'client_secret'</span><span class="token punctuation">:</span> github_client_secret<span class="token punctuation">,</span>
        <span class="token string">'code'</span><span class="token punctuation">:</span> request_code<span class="token punctuation">,</span>
        <span class="token string">'redirect_uri'</span><span class="token punctuation">:</span> redirect_url<span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
    data <span class="token operator">=</span> urllib<span class="token punctuation">.</span>urlencode<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    req <span class="token operator">=</span> urllib2<span class="token punctuation">.</span>Request<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token punctuation">,</span> headers<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">'Accept'</span><span class="token punctuation">:</span> <span class="token string">'application/json'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    response <span class="token operator">=</span> urllib2<span class="token punctuation">.</span>urlopen<span class="token punctuation">(</span>req<span class="token punctuation">)</span>
    result <span class="token operator">=</span> response<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
    result <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>result<span class="token punctuation">)</span>
    <span class="token comment"># print result</span>
    <span class="token comment"># --------------------------</span>
    <span class="token comment"># 通过传入access_token，访问服务端数据</span>
    access_token <span class="token operator">=</span> result<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&quot;access_token&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span>
    token_type <span class="token operator">=</span> result<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&quot;token_type&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span>
    token_url <span class="token operator">=</span> <span class="token string">'https://api.github.com/user?access_token=%s'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>access_token<span class="token punctuation">)</span>
    token_response <span class="token operator">=</span> urllib2<span class="token punctuation">.</span>urlopen<span class="token punctuation">(</span>token_url<span class="token punctuation">)</span>
    html <span class="token operator">=</span> token_response<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
    data <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>html<span class="token punctuation">)</span>
    <span class="token comment"># print data</span>
    <span class="token keyword">return</span> render_to_response<span class="token punctuation">(</span><span class="token string">'index.html'</span><span class="token punctuation">,</span> <span class="token builtin">locals</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/blog-web/bigData/pandas.html" class="prev">
        pandas
      </a></span> <span class="next"><a href="/blog-web/bigData/linux.html">
        Linux基础
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/blog-web/assets/js/app.1e93224c.js" defer></script><script src="/blog-web/assets/js/2.7ae4b6a2.js" defer></script><script src="/blog-web/assets/js/14.0f3679a0.js" defer></script>
  </body>
</html>
