<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Nginx配置 | 我的博客</title>
    <meta name="generator" content="VuePress 1.4.1">
    
    <meta name="description" content="">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="preload" href="/blog-web/assets/css/0.styles.7d8f2a25.css" as="style"><link rel="preload" href="/blog-web/assets/js/app.ed324a7a.js" as="script"><link rel="preload" href="/blog-web/assets/js/2.7ae4b6a2.js" as="script"><link rel="preload" href="/blog-web/assets/js/22.00d67ec1.js" as="script"><link rel="prefetch" href="/blog-web/assets/js/10.8719799f.js"><link rel="prefetch" href="/blog-web/assets/js/11.59ff8cb5.js"><link rel="prefetch" href="/blog-web/assets/js/12.c66dd946.js"><link rel="prefetch" href="/blog-web/assets/js/13.49a291a5.js"><link rel="prefetch" href="/blog-web/assets/js/14.06def431.js"><link rel="prefetch" href="/blog-web/assets/js/15.eac2db3e.js"><link rel="prefetch" href="/blog-web/assets/js/16.743f03c1.js"><link rel="prefetch" href="/blog-web/assets/js/17.8a7e9224.js"><link rel="prefetch" href="/blog-web/assets/js/18.e4784317.js"><link rel="prefetch" href="/blog-web/assets/js/19.44e9d9f4.js"><link rel="prefetch" href="/blog-web/assets/js/20.6029a3e1.js"><link rel="prefetch" href="/blog-web/assets/js/21.bda3f0ff.js"><link rel="prefetch" href="/blog-web/assets/js/23.2ed9af56.js"><link rel="prefetch" href="/blog-web/assets/js/24.ac89b12e.js"><link rel="prefetch" href="/blog-web/assets/js/25.94ce567c.js"><link rel="prefetch" href="/blog-web/assets/js/26.2b74cdb3.js"><link rel="prefetch" href="/blog-web/assets/js/27.73743c5e.js"><link rel="prefetch" href="/blog-web/assets/js/28.8a75bb1a.js"><link rel="prefetch" href="/blog-web/assets/js/29.30aaff9e.js"><link rel="prefetch" href="/blog-web/assets/js/3.cc4760fd.js"><link rel="prefetch" href="/blog-web/assets/js/30.36a5fd79.js"><link rel="prefetch" href="/blog-web/assets/js/31.0703b868.js"><link rel="prefetch" href="/blog-web/assets/js/32.ea26ddeb.js"><link rel="prefetch" href="/blog-web/assets/js/33.59d926b7.js"><link rel="prefetch" href="/blog-web/assets/js/34.b2ab71cd.js"><link rel="prefetch" href="/blog-web/assets/js/35.f05bc7ad.js"><link rel="prefetch" href="/blog-web/assets/js/36.5ff0ac76.js"><link rel="prefetch" href="/blog-web/assets/js/37.394f97bd.js"><link rel="prefetch" href="/blog-web/assets/js/38.313d7c83.js"><link rel="prefetch" href="/blog-web/assets/js/39.1c3fea4b.js"><link rel="prefetch" href="/blog-web/assets/js/4.3aabfd60.js"><link rel="prefetch" href="/blog-web/assets/js/40.3127cc97.js"><link rel="prefetch" href="/blog-web/assets/js/41.9c0d9c94.js"><link rel="prefetch" href="/blog-web/assets/js/42.802d7492.js"><link rel="prefetch" href="/blog-web/assets/js/43.61ab7677.js"><link rel="prefetch" href="/blog-web/assets/js/44.677bb1aa.js"><link rel="prefetch" href="/blog-web/assets/js/45.29fb8627.js"><link rel="prefetch" href="/blog-web/assets/js/46.5ad71a59.js"><link rel="prefetch" href="/blog-web/assets/js/47.8002d794.js"><link rel="prefetch" href="/blog-web/assets/js/48.2c825593.js"><link rel="prefetch" href="/blog-web/assets/js/49.898db852.js"><link rel="prefetch" href="/blog-web/assets/js/5.32fd48d8.js"><link rel="prefetch" href="/blog-web/assets/js/50.a61bd853.js"><link rel="prefetch" href="/blog-web/assets/js/51.0b2b3d0c.js"><link rel="prefetch" href="/blog-web/assets/js/52.b0ef0006.js"><link rel="prefetch" href="/blog-web/assets/js/53.d85ac714.js"><link rel="prefetch" href="/blog-web/assets/js/54.bf8a2613.js"><link rel="prefetch" href="/blog-web/assets/js/55.0d5bc19f.js"><link rel="prefetch" href="/blog-web/assets/js/56.a898137f.js"><link rel="prefetch" href="/blog-web/assets/js/57.4c64dabd.js"><link rel="prefetch" href="/blog-web/assets/js/58.3ecb88c9.js"><link rel="prefetch" href="/blog-web/assets/js/59.98218a1b.js"><link rel="prefetch" href="/blog-web/assets/js/6.3a266898.js"><link rel="prefetch" href="/blog-web/assets/js/60.853a217b.js"><link rel="prefetch" href="/blog-web/assets/js/61.ec5840e3.js"><link rel="prefetch" href="/blog-web/assets/js/62.d8ca83e5.js"><link rel="prefetch" href="/blog-web/assets/js/63.fee0b8b2.js"><link rel="prefetch" href="/blog-web/assets/js/64.a2d466ed.js"><link rel="prefetch" href="/blog-web/assets/js/7.2de9b0d5.js"><link rel="prefetch" href="/blog-web/assets/js/8.808872ec.js"><link rel="prefetch" href="/blog-web/assets/js/9.5229d144.js">
    <link rel="stylesheet" href="/blog-web/assets/css/0.styles.7d8f2a25.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog-web/" class="home-link router-link-active"><!----> <span class="site-name">我的博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog-web/web/" class="nav-link">
  Web
</a></div><div class="nav-item"><a href="/blog-web/bigData/" class="nav-link router-link-active">
  后端
</a></div><div class="nav-item"><a href="/blog-web/git/" class="nav-link">
  Git
</a></div><div class="nav-item"><a href="/blog-web/install/" class="nav-link">
  安装
</a></div><div class="nav-item"><a href="/blog-web/other/" class="nav-link">
  其他
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog-web/web/" class="nav-link">
  Web
</a></div><div class="nav-item"><a href="/blog-web/bigData/" class="nav-link router-link-active">
  后端
</a></div><div class="nav-item"><a href="/blog-web/git/" class="nav-link">
  Git
</a></div><div class="nav-item"><a href="/blog-web/install/" class="nav-link">
  安装
</a></div><div class="nav-item"><a href="/blog-web/other/" class="nav-link">
  其他
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>后端技术总结</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog-web/bigData/" class="sidebar-link">Introduction</a></li><li><a href="/blog-web/bigData/mysql.html" class="sidebar-link">MySql</a></li><li><a href="/blog-web/bigData/redis.html" class="sidebar-link">redis基础</a></li><li><a href="/blog-web/bigData/es.html" class="sidebar-link">Elasticsearch</a></li><li><a href="/blog-web/bigData/kylin.html" class="sidebar-link">Kylin知识整理</a></li><li><a href="/blog-web/bigData/hybrid.html" class="sidebar-link">hybrid优化总结</a></li><li><a href="/blog-web/bigData/python.html" class="sidebar-link">Python</a></li><li><a href="/blog-web/bigData/pandas.html" class="sidebar-link">pandas</a></li><li><a href="/blog-web/bigData/django.html" class="sidebar-link">Django</a></li><li><a href="/blog-web/bigData/linux.html" class="sidebar-link">Linux基础</a></li><li><a href="/blog-web/bigData/nginx.html" class="active sidebar-link">Nginx配置</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog-web/bigData/nginx.html#顶级配置" class="sidebar-link">顶级配置</a></li><li class="sidebar-sub-header"><a href="/blog-web/bigData/nginx.html#events-模块" class="sidebar-link">Events 模块</a></li><li class="sidebar-sub-header"><a href="/blog-web/bigData/nginx.html#http-模块" class="sidebar-link">HTTP 模块</a></li><li class="sidebar-sub-header"><a href="/blog-web/bigData/nginx.html#server-模块" class="sidebar-link">SERVER 模块</a></li><li class="sidebar-sub-header"><a href="/blog-web/bigData/nginx.html#其他配置" class="sidebar-link">其他配置</a></li></ul></li><li><a href="/blog-web/bigData/aws-s3.html" class="sidebar-link">aws s3 命令</a></li><li><a href="/blog-web/bigData/hive.html" class="sidebar-link">hive</a></li><li><a href="/blog-web/bigData/hdfs.html" class="sidebar-link">DHFS基础</a></li><li><a href="/blog-web/bigData/hbase.html" class="sidebar-link">HBASE</a></li><li><a href="/blog-web/bigData/spark.html" class="sidebar-link">Spark</a></li><li><a href="/blog-web/bigData/luigi.html" class="sidebar-link">Luigi和sciluigi</a></li><li><a href="/blog-web/bigData/scala.html" class="sidebar-link">scala基础</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="nginx配置"><a href="#nginx配置" class="header-anchor">#</a> Nginx配置</h1> <ul><li><a href="http://nginx.org/en/docs/" target="_blank" rel="noopener noreferrer">资料1<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="http://www.oschina.net/translate/nginx-setup" target="_blank" rel="noopener noreferrer">资料2<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="http://www.ha97.com/5194.html" target="_blank" rel="noopener noreferrer">资料3<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <h2 id="顶级配置"><a href="#顶级配置" class="header-anchor">#</a> 顶级配置</h2> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token comment"># 定义 Nginx 运行的用户和用户组</span>
user nginx<span class="token punctuation">;</span>

<span class="token comment"># 进程文件,刚安装的时候没有，在启动nginx时自动生成的,里面存放的是当前nginx进程的ID号</span>
pid /var/run/nginx.pid<span class="token punctuation">;</span>
<span class="token comment"># nginx的结束重启命令,其中26000是nginx的主进程号：</span>
<span class="token function">kill</span> -QUIT <span class="token number">26000</span>

<span class="token comment"># 错误日志位置和级别，debug、info、notice、warn、error、crit,默认为crit</span>
<span class="token comment"># 说明：crit 记录的日志最少，而debug记录的日志最多</span>
error_log  /var/log/nginx/error.log warn<span class="token punctuation">;</span>

<span class="token comment"># Nginx worker 的进程数，一般可设置为可用的CPU内核数。</span>
worker_processes <span class="token number">8</span><span class="token punctuation">;</span>

<span class="token comment"># 每个 worker 打开文件描述符的最大数量限制。理论值应该是最多打开文件数（系统的值ulimit -n）与 nginx 进程数相除，但是 nginx 分配请求并不均匀，所以建议与ulimit -n的值保持一致。</span>
worker_rlimit_nofile <span class="token number">65535</span><span class="token punctuation">;</span>
</code></pre></div><p>修改系统文件打开数量限制</p> <div class="language-sh extra-class"><pre class="language-sh"><code>events <span class="token punctuation">{</span>
    <span class="token comment">#设置一个worker进程同时打开的最大连接数</span>
    worker_connections <span class="token number">2048</span><span class="token punctuation">;</span>

    <span class="token comment">#告诉nginx收到一个新连接通知后接受尽可能多的连接</span>
    multi_accept on<span class="token punctuation">;</span>

    <span class="token comment"># 设置用于复用客户端线程的轮询方法。如果你使用Linux </span>
    <span class="token number">2.6</span>+，你应该使用epoll。如果你使用*BSD，你应该使用kqueue。
    use epoll<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>重启后永久生效，则需要设置修改：</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">sudo</span> <span class="token function">vim</span> /etc/security/limits.conf
</code></pre></div><p>在文件尾部添加：</p> <div class="language-sh extra-class"><pre class="language-sh"><code>* soft nofile <span class="token number">200000</span>
* hard nofile <span class="token number">200000</span>
</code></pre></div><p>include</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token comment"># include  /etc/nginx/mime.types;</span>
include 是一个在当前文件中包含另一个文件内容的指令。这里我们使用它来加载文件扩展名与文件类型映射表。nginx根据映射关系，设置http请求响应头的Content-Type值。当在映射表找不到时，使用nginx.conf中default-type指定的默认值。
</code></pre></div><h2 id="events-模块"><a href="#events-模块" class="header-anchor">#</a> Events 模块</h2> <div class="language-sh extra-class"><pre class="language-sh"><code>events <span class="token punctuation">{</span>
    <span class="token comment">#设置一个worker进程同时打开的最大连接数</span>
    worker_connections <span class="token number">2048</span><span class="token punctuation">;</span>

    <span class="token comment">#告诉nginx收到一个新连接通知后接受尽可能多的连接</span>
    multi_accept on<span class="token punctuation">;</span>

    <span class="token comment">#设置用于复用客户端线程的轮询方法。如果你使用Linux 2.6+，你应该使用epoll。如果你使用*BSD，你应该使用kqueue。</span>
    use epoll<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="http-模块"><a href="#http-模块" class="header-anchor">#</a> HTTP 模块</h2> <div class="language-sh extra-class"><pre class="language-sh"><code>http <span class="token punctuation">{</span>
    <span class="token comment">#隐藏 Nginx 的版本号，提高安全性。</span>
    server_tokens off<span class="token punctuation">;</span>

    <span class="token comment">#开启高效文件传输模式，sendfile 指令指定 Nginx 是否调用sendfile 函数来输出文件，对于普通应用设为 on，如果用来进行下载等应用磁盘 IO 重负载应用，可设置为 off，以平衡磁盘与网络 I/O 处理速度，降低系统的负载。</span>
    sendfile on<span class="token punctuation">;</span>

    <span class="token comment">#是否开启目录列表访问，默认关闭。</span>
    autoindex off<span class="token punctuation">;</span>

    <span class="token comment">#告诉 Nginx 在一个数据包里发送所有头文件，而不一个接一个的发送</span>
    tcp_nopush on<span class="token punctuation">;</span>

    <span class="token comment">#告诉 Nginx 不要缓存数据，而是一段一段的发送--当需要及时发送数据时，就应该给应用设置这个属性，这样发送一小块数据信息时就不能立即得到返回值。Nginx 默认会始终工作在 tcp nopush 状态下。但是当开启前面的 sendfile on; 时，它的工作特点是 nopush 的最后一个包会自动转转换到 nopush off。为了减小那200ms的延迟，开启 nodelay on; 将其很快传送出去。结论就是 sendfile on; 开启时，tcp_nopush 和 tcp_nodelay 都是on 是可以的。</span>
    tcp_nodelay on<span class="token punctuation">;</span>

    <span class="token comment">#日志格式设定</span>
    log_format  main  <span class="token string">'<span class="token variable">$remote_addr</span> - <span class="token variable">$remote_user</span> [<span class="token variable">$time_local</span>] &quot;<span class="token variable">$request</span>&quot; '</span>
    <span class="token string">'<span class="token variable">$status</span> <span class="token variable">$body_bytes_sent</span> &quot;<span class="token variable">$http_referer</span>&quot; '</span>
    <span class="token string">'&quot;<span class="token variable">$http_user_agent</span>&quot; &quot;<span class="token variable">$http_x_forwarded_for</span>&quot;'</span><span class="token punctuation">;</span>
    <span class="token comment">#定义访问日志，设置为 off 可以关闭日志，提高性能</span>
    access_log /var/log/nginx/access.log main<span class="token punctuation">;</span>


    <span class="token comment">#连接超时时间，单位是秒</span>
    keepalive_timeout <span class="token number">120</span><span class="token punctuation">;</span>

    <span class="token comment">#读取HTTP头部的超时时间，默认值 60。客户端与服务器建立连接后将开始接收HTTP头部，在这个过程中，如果在一个时间间隔（超时时间）内没有读取到客户端发来的字节，则认为超时，并向客户端返回408 (&quot;Request timed out&quot;)响应。</span>
    client_header_timeout <span class="token number">60</span><span class="token punctuation">;</span>

    <span class="token comment">#默认值 60。与client_header_timeout相似，只是这个超时时间只在读取HTTP包体时才有效。</span>
    client_body_timeout <span class="token number">10</span><span class="token punctuation">;</span>

    <span class="token comment">#发送响应的超时时间，默认值 60。即Nginx服务器向客户端发送了数据包，但客户端一直没有去接收这个数据包。如果某个连接超过send_timeout定义的超时时间，那么Nginx将会关闭这个连接。</span>
    send_timeout <span class="token number">60</span><span class="token punctuation">;</span>

    <span class="token comment">#连接超时后将通过向客户端发送RST包来直接重置连接。这个选项打开后，Nginx会在某个连接超时后，不是使用正常情形下的四次握手关闭TCP连接，而是直接向用户发送RST重置包，不再等待用户的应答，直接释放Nginx服务器上关于这个套接字使用的所有缓存（如TCP滑动窗口）。相比正常的关闭方式，它使得服务器避免产生许多处于FIN_WAIT_1、FIN_WAIT_2、TIME_WAIT状态的TCP连接。注意，使用RST重置包关闭连接会带来一些问题，默认情况下不会开启。</span>
    reset_timedout_connection off<span class="token punctuation">;</span>

    <span class="token comment">#要限制连接，必须先有一个容器对连接进行计数，&quot;zone=&quot; 是给它一个名字，可以随便叫，这个名字要跟下面的 limit_conn 一致。$binary_remote_addr 用二进制来储存客户端的地址，1m 可以储存 32000 个并发会话。</span>
    limit_conn_zone <span class="token variable">$binary_remote_addr</span> <span class="token assign-left variable">zone</span><span class="token operator">=</span>addr:5m<span class="token punctuation">;</span>

    <span class="token comment">#给定的key设置最大连接数。这里key是addr，我们设置的值是100，也就是说我们允许每一个IP地址最多同时打开有100个连接。</span>
    limit_conn addr <span class="token number">100</span><span class="token punctuation">;</span>

    <span class="token comment">#对每个连接限速100k。这如果一个IP允许两个并发连接，那么这个IP就是限速200K。</span>
    limit_rate 100k<span class="token punctuation">;</span> 

    <span class="token comment">#include 是一个在当前文件中包含另一个文件内容的指令。这里我们使用它来加载文件扩展名与文件类型映射表。nginx根据映射关系，设置http请求响应头的Content-Type值。当在映射表找不到时，使用nginx.conf中default-type指定的默认值。</span>
    include /etc/nginx/mime.types<span class="token punctuation">;</span>

    <span class="token comment">#设置文件使用的默认的MIME-type</span>
    default_type text/html<span class="token punctuation">;</span>

    <span class="token comment">#默认编码</span>
    charset UTF-8<span class="token punctuation">;</span>

    <span class="token comment">#该模块可以读取预先压缩的gz文件，这样可以减少每次请求进行gzip压缩的CPU资源消耗。该模块启用后，nginx首先检查是否存在请求静态文件的gz结尾的文件，如果有则直接返回该gz文件内容。</span>
    gzip_static off<span class="token punctuation">;</span>  

    <span class="token comment">#开启 gzip 压缩。</span>
    <span class="token function">gzip</span> on<span class="token punctuation">;</span>

    <span class="token comment"># 禁用客户端为 IE6 时的 gzip功能。</span>
    gzip_disable <span class="token string">&quot;msie6&quot;</span><span class="token punctuation">;</span>

    <span class="token comment">#Nginx做为反向代理的时候启用。可选值：off|expired|no-cache|no-sotre|private|no_last_modified|no_etag|auth|any</span>
    gzip_proxied any<span class="token punctuation">;</span>

    <span class="token comment">#设置允许压缩的页面最小字节数，页面字节数从header头中的Content-Length中进行获取。建议设置成大于1k的字节数，小于1k可能会越压越大。</span>
    gzip_min_length <span class="token number">1024</span><span class="token punctuation">;</span>

    <span class="token comment">#设置数据的压缩等级。这个等级可以是1-9之间的任意数值，9是最慢但是压缩比最大的。</span>
    gzip_comp_level <span class="token number">5</span><span class="token punctuation">;</span>

    <span class="token comment">#设置系统获取几个单位的缓存用于存储gzip的压缩结果数据流。 例如 4 4k 代表以4k为单位，按照原始数据大小以4k为单位的4倍申请内存。如果没有设置，默认值是申请跟原始数据相同大小的内存空间去存储gzip压缩结果。</span>
    gzip_buffers <span class="token number">4</span> 16k<span class="token punctuation">;</span>

    <span class="token comment">#设置需要压缩的数据格式。Nginx默认只对text/html进行压缩。</span>
    gzip_types text/plain text/css application/json application/x-javascript text/xml application/xml application/xml+rss text/javascript<span class="token punctuation">;</span>

    <span class="token comment">#为打开文件指定缓存，默认是没有启用的，max 指定缓存数量，建议和打开文件数一致，inactive 是指经过多长时间文件没被请求后删除缓存。</span>
    open_file_cache <span class="token assign-left variable">max</span><span class="token operator">=</span><span class="token number">65535</span> <span class="token assign-left variable">inactive</span><span class="token operator">=</span>30s<span class="token punctuation">;</span>

    <span class="token comment">#多长时间检查一次缓存的有效信息</span>
    open_file_cache_valid 30s<span class="token punctuation">;</span>

    <span class="token comment">#open_file_cache指令中的inactive参数时间内文件的最少使用次数，如果超过这个数字，文件描述符一直是在缓存中打开的。出现 Last-Modified 不变的情况，就是因为当nginx对一个静态文件缓存后，如果30s内还在访问它，那么它的缓存就一直存在，直到30s内你不访问了为止。</span>
    open_file_cache_min_uses <span class="token number">2</span><span class="token punctuation">;</span>
    
    <span class="token comment">#是否记录cache错误</span>
    open_file_cache_errors on<span class="token punctuation">;</span>
    include /etc/nginx/conf.d/*.conf<span class="token punctuation">;</span>
    include /etc/nginx/sites-enabled/*<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="server-模块"><a href="#server-模块" class="header-anchor">#</a> SERVER 模块</h2> <div class="language-sh extra-class"><pre class="language-sh"><code>server <span class="token punctuation">{</span>
    <span class="token comment">#监听端口，nginx 会根据请求的 HOST 来决定使用哪个 SERVER 段的配置。如果没有匹配的 server_name，则默认使用配置文件中第一个。加上 default_server 则可以以指定没有匹配时的默认规则。</span>
    <span class="token comment">#listen 80;</span>
    listen <span class="token number">80</span> default_server<span class="token punctuation">;</span>

    <span class="token comment">#域名可以有多个，用空格隔开</span>
    server_name www.test.com test.com<span class="token punctuation">;</span>
    root /user/share/nginx/html/test<span class="token punctuation">;</span>

    <span class="token comment">#404页面配置</span>
    error_page   <span class="token number">404</span>   /404.html<span class="token punctuation">;</span>

    <span class="token comment">#配置 ssl，有需要时开启。</span>
    ssl on<span class="token punctuation">;</span>
    ssl_certificate /etc/nginx/ssl/server.crt<span class="token punctuation">;</span>
    ssl_certificate_key /etc/nginx/ssl/server.key<span class="token punctuation">;</span>

    location / <span class="token punctuation">{</span>
        index   index.html index.php<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">#图片缓存时间设置</span>
    location ~ .*.<span class="token punctuation">(</span>gif<span class="token operator">|</span>jpg<span class="token operator">|</span>jpeg<span class="token operator">|</span>png<span class="token operator">|</span>bmp<span class="token operator">|</span>swf<span class="token punctuation">)</span>$ <span class="token punctuation">{</span>
        expires 10d<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">#JS和CSS缓存时间设置</span>
    location ~ .*.<span class="token punctuation">(</span>js<span class="token operator">|</span>css<span class="token punctuation">)</span>?$ <span class="token punctuation">{</span>
        expires 1h<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    location ~ <span class="token punctuation">[</span>^/<span class="token punctuation">]</span><span class="token punctuation">\</span>.php<span class="token punctuation">(</span>/<span class="token operator">|</span>$<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        fastcgi_index   index.php<span class="token punctuation">;</span>
        <span class="token comment">#开启 PATH_INFO 支持，作用就是把参数按照给定的正则表达式分割成 $fastcgi_script_name 和 $fastcgi_path_info。</span>
        <span class="token comment">#例如：请求 index.php/id/1 不加此行配置时，fastcgi_script_name 是 /index.php/id/1，fastcgi_path_info 是空。</span>
        <span class="token comment">#加上之后，fastcgi_script_name 是 index.php，fastcgi_path_info 是 /id/1</span>
        fastcgi_split_path_info ^<span class="token punctuation">(</span>.+<span class="token punctuation">\</span>.php<span class="token punctuation">)</span><span class="token punctuation">(</span>.*<span class="token punctuation">)</span>$<span class="token punctuation">;</span>

        <span class="token comment">#此值即是 PHP 中 $_SERVER['SCRIPT_FILENAME'] 的值</span>
        fastcgi_param   SCRIPT_FILENAME <span class="token variable">$document_root</span><span class="token variable">$fastcgi_script_name</span><span class="token punctuation">;</span>
        fastcgi_param   PATH_INFO               <span class="token variable">$fastcgi_path_info</span><span class="token punctuation">;</span>
        fastcgi_param   PATH_TRANSLATED <span class="token variable">$document_root</span><span class="token variable">$fastcgi_path_info</span><span class="token punctuation">;</span>

        <span class="token comment">#指定FastCGI服务器监听端口与地址。须和 PHP-FPM 的设置相同。</span>
        <span class="token comment">#fastcgi_pass   127.0.0.1:9000;</span>
        fastcgi_pass    unix:/var/run/php5-fpm.sock<span class="token punctuation">;</span>
        include fastcgi_params<span class="token punctuation">;</span>
</code></pre></div><h2 id="其他配置"><a href="#其他配置" class="header-anchor">#</a> 其他配置</h2> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token comment"># access.log</span>
server段不指定access_log时，并且http段中也未指定任何access_log参数时，它会默认写到logs/access.log这个文件，也就是access_log默认值就是”logs/access.log”
main 是日志定义格式。
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/blog-web/bigData/linux.html" class="prev">
        Linux基础
      </a></span> <span class="next"><a href="/blog-web/bigData/aws-s3.html">
        aws s3 命令
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/blog-web/assets/js/app.ed324a7a.js" defer></script><script src="/blog-web/assets/js/2.7ae4b6a2.js" defer></script><script src="/blog-web/assets/js/22.00d67ec1.js" defer></script>
  </body>
</html>
