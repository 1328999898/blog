<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>redis基础 | 我的博客</title>
    <meta name="generator" content="VuePress 1.4.1">
    
    <meta name="description" content="">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="preload" href="/blog-web/assets/css/0.styles.7d8f2a25.css" as="style"><link rel="preload" href="/blog-web/assets/js/app.ed324a7a.js" as="script"><link rel="preload" href="/blog-web/assets/js/2.7ae4b6a2.js" as="script"><link rel="preload" href="/blog-web/assets/js/26.2b74cdb3.js" as="script"><link rel="prefetch" href="/blog-web/assets/js/10.8719799f.js"><link rel="prefetch" href="/blog-web/assets/js/11.59ff8cb5.js"><link rel="prefetch" href="/blog-web/assets/js/12.c66dd946.js"><link rel="prefetch" href="/blog-web/assets/js/13.49a291a5.js"><link rel="prefetch" href="/blog-web/assets/js/14.06def431.js"><link rel="prefetch" href="/blog-web/assets/js/15.eac2db3e.js"><link rel="prefetch" href="/blog-web/assets/js/16.743f03c1.js"><link rel="prefetch" href="/blog-web/assets/js/17.8a7e9224.js"><link rel="prefetch" href="/blog-web/assets/js/18.e4784317.js"><link rel="prefetch" href="/blog-web/assets/js/19.44e9d9f4.js"><link rel="prefetch" href="/blog-web/assets/js/20.6029a3e1.js"><link rel="prefetch" href="/blog-web/assets/js/21.bda3f0ff.js"><link rel="prefetch" href="/blog-web/assets/js/22.00d67ec1.js"><link rel="prefetch" href="/blog-web/assets/js/23.2ed9af56.js"><link rel="prefetch" href="/blog-web/assets/js/24.ac89b12e.js"><link rel="prefetch" href="/blog-web/assets/js/25.94ce567c.js"><link rel="prefetch" href="/blog-web/assets/js/27.73743c5e.js"><link rel="prefetch" href="/blog-web/assets/js/28.8a75bb1a.js"><link rel="prefetch" href="/blog-web/assets/js/29.30aaff9e.js"><link rel="prefetch" href="/blog-web/assets/js/3.cc4760fd.js"><link rel="prefetch" href="/blog-web/assets/js/30.36a5fd79.js"><link rel="prefetch" href="/blog-web/assets/js/31.0703b868.js"><link rel="prefetch" href="/blog-web/assets/js/32.ea26ddeb.js"><link rel="prefetch" href="/blog-web/assets/js/33.59d926b7.js"><link rel="prefetch" href="/blog-web/assets/js/34.b2ab71cd.js"><link rel="prefetch" href="/blog-web/assets/js/35.f05bc7ad.js"><link rel="prefetch" href="/blog-web/assets/js/36.5ff0ac76.js"><link rel="prefetch" href="/blog-web/assets/js/37.394f97bd.js"><link rel="prefetch" href="/blog-web/assets/js/38.313d7c83.js"><link rel="prefetch" href="/blog-web/assets/js/39.1c3fea4b.js"><link rel="prefetch" href="/blog-web/assets/js/4.3aabfd60.js"><link rel="prefetch" href="/blog-web/assets/js/40.3127cc97.js"><link rel="prefetch" href="/blog-web/assets/js/41.9c0d9c94.js"><link rel="prefetch" href="/blog-web/assets/js/42.802d7492.js"><link rel="prefetch" href="/blog-web/assets/js/43.61ab7677.js"><link rel="prefetch" href="/blog-web/assets/js/44.677bb1aa.js"><link rel="prefetch" href="/blog-web/assets/js/45.29fb8627.js"><link rel="prefetch" href="/blog-web/assets/js/46.5ad71a59.js"><link rel="prefetch" href="/blog-web/assets/js/47.8002d794.js"><link rel="prefetch" href="/blog-web/assets/js/48.2c825593.js"><link rel="prefetch" href="/blog-web/assets/js/49.898db852.js"><link rel="prefetch" href="/blog-web/assets/js/5.32fd48d8.js"><link rel="prefetch" href="/blog-web/assets/js/50.a61bd853.js"><link rel="prefetch" href="/blog-web/assets/js/51.0b2b3d0c.js"><link rel="prefetch" href="/blog-web/assets/js/52.b0ef0006.js"><link rel="prefetch" href="/blog-web/assets/js/53.d85ac714.js"><link rel="prefetch" href="/blog-web/assets/js/54.bf8a2613.js"><link rel="prefetch" href="/blog-web/assets/js/55.0d5bc19f.js"><link rel="prefetch" href="/blog-web/assets/js/56.a898137f.js"><link rel="prefetch" href="/blog-web/assets/js/57.4c64dabd.js"><link rel="prefetch" href="/blog-web/assets/js/58.3ecb88c9.js"><link rel="prefetch" href="/blog-web/assets/js/59.98218a1b.js"><link rel="prefetch" href="/blog-web/assets/js/6.3a266898.js"><link rel="prefetch" href="/blog-web/assets/js/60.853a217b.js"><link rel="prefetch" href="/blog-web/assets/js/61.ec5840e3.js"><link rel="prefetch" href="/blog-web/assets/js/62.d8ca83e5.js"><link rel="prefetch" href="/blog-web/assets/js/63.fee0b8b2.js"><link rel="prefetch" href="/blog-web/assets/js/64.a2d466ed.js"><link rel="prefetch" href="/blog-web/assets/js/7.2de9b0d5.js"><link rel="prefetch" href="/blog-web/assets/js/8.808872ec.js"><link rel="prefetch" href="/blog-web/assets/js/9.5229d144.js">
    <link rel="stylesheet" href="/blog-web/assets/css/0.styles.7d8f2a25.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog-web/" class="home-link router-link-active"><!----> <span class="site-name">我的博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog-web/web/" class="nav-link">
  Web
</a></div><div class="nav-item"><a href="/blog-web/bigData/" class="nav-link router-link-active">
  后端
</a></div><div class="nav-item"><a href="/blog-web/git/" class="nav-link">
  Git
</a></div><div class="nav-item"><a href="/blog-web/install/" class="nav-link">
  安装
</a></div><div class="nav-item"><a href="/blog-web/other/" class="nav-link">
  其他
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog-web/web/" class="nav-link">
  Web
</a></div><div class="nav-item"><a href="/blog-web/bigData/" class="nav-link router-link-active">
  后端
</a></div><div class="nav-item"><a href="/blog-web/git/" class="nav-link">
  Git
</a></div><div class="nav-item"><a href="/blog-web/install/" class="nav-link">
  安装
</a></div><div class="nav-item"><a href="/blog-web/other/" class="nav-link">
  其他
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>后端技术总结</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog-web/bigData/" class="sidebar-link">Introduction</a></li><li><a href="/blog-web/bigData/mysql.html" class="sidebar-link">MySql</a></li><li><a href="/blog-web/bigData/redis.html" class="active sidebar-link">redis基础</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog-web/bigData/redis.html#introduction" class="sidebar-link">Introduction</a></li><li class="sidebar-sub-header"><a href="/blog-web/bigData/redis.html#字符串类型" class="sidebar-link">字符串类型</a></li><li class="sidebar-sub-header"><a href="/blog-web/bigData/redis.html#散列类型" class="sidebar-link">散列类型</a></li><li class="sidebar-sub-header"><a href="/blog-web/bigData/redis.html#列表类型" class="sidebar-link">列表类型</a></li><li class="sidebar-sub-header"><a href="/blog-web/bigData/redis.html#集合类型" class="sidebar-link">集合类型</a></li><li class="sidebar-sub-header"><a href="/blog-web/bigData/redis.html#有序集合" class="sidebar-link">有序集合</a></li><li class="sidebar-sub-header"><a href="/blog-web/bigData/redis.html#事务" class="sidebar-link">事务</a></li><li class="sidebar-sub-header"><a href="/blog-web/bigData/redis.html#编码格式" class="sidebar-link">编码格式</a></li><li class="sidebar-sub-header"><a href="/blog-web/bigData/redis.html#python与redis" class="sidebar-link">python与redis</a></li></ul></li><li><a href="/blog-web/bigData/es.html" class="sidebar-link">Elasticsearch</a></li><li><a href="/blog-web/bigData/kylin.html" class="sidebar-link">Kylin知识整理</a></li><li><a href="/blog-web/bigData/hybrid.html" class="sidebar-link">hybrid优化总结</a></li><li><a href="/blog-web/bigData/python.html" class="sidebar-link">Python</a></li><li><a href="/blog-web/bigData/pandas.html" class="sidebar-link">pandas</a></li><li><a href="/blog-web/bigData/django.html" class="sidebar-link">Django</a></li><li><a href="/blog-web/bigData/linux.html" class="sidebar-link">Linux基础</a></li><li><a href="/blog-web/bigData/nginx.html" class="sidebar-link">Nginx配置</a></li><li><a href="/blog-web/bigData/aws-s3.html" class="sidebar-link">aws s3 命令</a></li><li><a href="/blog-web/bigData/hive.html" class="sidebar-link">hive</a></li><li><a href="/blog-web/bigData/hdfs.html" class="sidebar-link">DHFS基础</a></li><li><a href="/blog-web/bigData/hbase.html" class="sidebar-link">HBASE</a></li><li><a href="/blog-web/bigData/spark.html" class="sidebar-link">Spark</a></li><li><a href="/blog-web/bigData/luigi.html" class="sidebar-link">Luigi和sciluigi</a></li><li><a href="/blog-web/bigData/scala.html" class="sidebar-link">scala基础</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="redis基础"><a href="#redis基础" class="header-anchor">#</a> redis基础</h1> <h2 id="introduction"><a href="#introduction" class="header-anchor">#</a> Introduction</h2> <p>redis(REmote Dictionary Server)远程字典服务器
，以字典结构存储数据，并允许其他应用通过TCP协议读写字典中的内容。redis数据库中的所有数据都存储在内存中，因此读写速度快于硬盘</p> <ol><li>开源免费</li> <li>C语言编写的</li> <li>key-value 方式存储数据</li></ol> <p>特点：</p> <ol><li>支持数据的持久化，可以将内存中的内容保持在磁盘中，机器重启的时候可以重新加载使用</li> <li>比memcached支持更多的数据类型，不仅仅支持key-value类型，还支持list、set、zset、hash等数据类型
memcached更多的是key-string，string类型基本可以模拟所有数据类型</li> <li>redis支持数据备份，即mater-slave模式的数据备份</li></ol> <p>redis支持异步将内存中的数据写到磁盘上，同时不影响服务</p> <h3 id="_1、redis支持的键值类型"><a href="#_1、redis支持的键值类型" class="header-anchor">#</a> 1、redis支持的键值类型</h3> <ul><li>字符串类型</li> <li>散列类型</li> <li>列表类型</li> <li>集合类型</li> <li>有序集合类型</li></ul> <h3 id="_2、redis和memcached"><a href="#_2、redis和memcached" class="header-anchor">#</a> 2、redis和memcached</h3> <ul><li>redis命令不区分大小写</li> <li>redis单线程</li> <li>memcached多线程</li> <li>redis可以限制数据占用的最大内存空间，数据达到空间限制后可以按照一定的规则自动淘汰不需要的键</li> <li>redis的列表类型的键可以用来实现队列，并且支持阻塞式读取</li> <li>redis是开源的</li></ul> <h3 id="_3、redis版本"><a href="#_3、redis版本" class="header-anchor">#</a> 3、Redis版本</h3> <ul><li>稳定版：次版本号（即第一个小数点后的数字）为偶数</li> <li>非稳定版：次版本号为奇数</li></ul> <h3 id="_4、redis的可执行文件"><a href="#_4、redis的可执行文件" class="header-anchor">#</a> 4、redis的可执行文件</h3> <ul><li>redis-server：redis服务器</li> <li>redis-cli：redis命令行客户端</li></ul> <h3 id="_5、redis命令"><a href="#_5、redis命令" class="header-anchor">#</a> 5、redis命令</h3> <blockquote><p>一个redis实例提供了多个用来存储数据的字典，客户端可以指定间数据存储在哪个字典中，可以将每个字典都理解成一个独立的数据库，每个数据库对外都是以一个从0开始的递增数字命名，redis默认支持16个数据库，可以通过配置参数databases来修改这一数字。客户端与redis建立连接之后会自动选择0号数据库，可以使用select命令更换数据库
keys命令需要遍历redis中的所有键，当键的数量较多时会影响性能，不建议在生产环境中使用</p></blockquote> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token comment"># 正常停止redis，redis收到命令后会断开所有客户端连接，然后根据配置执行持久化，然后退出</span>
$ redis-cli SHUTDOWN
<span class="token comment"># 通过kill redis 的pid也可以正常结束，效果同执行SHUTDOWN一样</span>
<span class="token comment"># redis-cli执行是会自动按照默认配置（服务器地址：127.0.0.1，端口：6379）连接redis</span>
$ redis-cli
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span>
<span class="token comment"># redis-cli也可以通过-h 服务器地址 -p 端口号 连接redis</span>
$ redis-cli -h <span class="token number">127.0</span>.0.1 -p <span class="token number">6379</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span>
<span class="token comment"># ping 用来测试连接是否正常，如果正常会输出PONG</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> <span class="token function">ping</span>
PONG
<span class="token comment"># 更换为1号数据库</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> <span class="token keyword">select</span> <span class="token number">1</span>
OK
<span class="token comment"># 建立一个名为bar的键</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token builtin class-name">set</span> bar <span class="token number">1</span>
OK
<span class="token comment"># 查询redis中所有的键</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> keys *
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;bar&quot;</span>
<span class="token comment"># 查询ba开头的所有键</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> keys ba*
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;bar&quot;</span>
<span class="token comment"># 查询键名为bar的键</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> keys bar
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;bar&quot;</span>
</code></pre></div><ul><li>判断键名是否存在、</li></ul> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token comment"># 判断键名为bar的键是否存在</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> exists bar
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> exists noexists
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">0</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> exists <span class="token number">111</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">0</span>
</code></pre></div><ul><li>删除键</li></ul> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token comment"># 删除一个或者多个键，返回值是删除的键的个数</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> del bar
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> keys *
<span class="token punctuation">(</span>empty list or <span class="token builtin class-name">set</span><span class="token punctuation">)</span>
<span class="token comment"># del命令不支持通配符，但是可以通过Linux的管道和xargs命令自己实现删除符合规则的键</span>
<span class="token comment"># redis-cli del 性能更好</span>
$ redis-cli del <span class="token variable"><span class="token variable">`</span>redis-cli keys <span class="token string">&quot;a*&quot;</span><span class="token variable">`</span></span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">3</span>
$ redis-cli keys <span class="token string">&quot;a*&quot;</span> <span class="token operator">|</span> <span class="token function">xargs</span> redis-cli del
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">3</span>
</code></pre></div><ul><li>键值得数据类型</li></ul> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token comment"># type的返回值可能是string（字符串类型）、hash（散列类型）、list（列表类型）、set（集合类型）、zset（有序集合类型）</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token builtin class-name">set</span> a1 <span class="token number">1</span>
OK
<span class="token comment"># type命令用来获取键值的数据类型</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token builtin class-name">type</span> a1
string
<span class="token comment"># lpush：向指定的列表类型键中增加一个元素，如果键不存在则创建它(list的方法)</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> lpush bar <span class="token number">1</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> <span class="token builtin class-name">type</span> bar
list
</code></pre></div><h2 id="字符串类型"><a href="#字符串类型" class="header-anchor">#</a> 字符串类型</h2> <blockquote><p>redis中最基本的数据类型，可以存储任何形式的字符串，一个字符串类型键允许存储的数据的最大容量为512MB</p></blockquote> <ul><li>赋值与取值</li></ul> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token comment"># set赋值</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> <span class="token builtin class-name">set</span> b2 <span class="token number">1</span>
OK
<span class="token comment"># get取值</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> get b2
<span class="token string">&quot;1&quot;</span>
<span class="token comment"># incr递增数字，当键不存在时默认键值为0，当键值不是整数时，redis会报错</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> incr num
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token comment"># 增加指定的整数</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> incrby num <span class="token number">3</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">6</span>
<span class="token comment"># 减少指定的整数</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> decrby num <span class="token number">2</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">4</span>
<span class="token comment"># 减少一个整数</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> decr num
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">3</span>
<span class="token comment"># 增加指定浮点数</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> incrbyfloat num <span class="token number">3.3</span>
<span class="token string">&quot;6.3&quot;</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> incrbyfloat num 4E+2
<span class="token string">&quot;406.29999999999999999&quot;</span>
</code></pre></div><ul><li>追加</li></ul> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token builtin class-name">set</span> key hello
OK
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> get key
<span class="token string">&quot;hello&quot;</span>
<span class="token comment"># append追加键值</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> append key <span class="token string">&quot; world&quot;</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">11</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> get key
<span class="token string">&quot;hello world&quot;</span>
<span class="token comment"># strlen获取键值得长度</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> strlen key
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">11</span>
</code></pre></div><ul><li>同时操作多个键值</li></ul> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token comment"># 同时设置多个键值</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> mset a1 <span class="token number">1</span> a2 <span class="token number">2</span> a3 <span class="token number">3</span>
OK
<span class="token comment"># 同时获得多个键值</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> mget a1 a2 a3
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;1&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;2&quot;</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">&quot;3&quot;</span>
</code></pre></div><h2 id="散列类型"><a href="#散列类型" class="header-anchor">#</a> 散列类型</h2> <blockquote><p>redis的数据类型不能嵌套其他的数据类型，一个散列类型的键可以包含2的32次幂-1个字段</p></blockquote> <ul><li>赋值和取值</li></ul> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token comment"># 赋值</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> hset car price <span class="token number">500</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> hset car name aa
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token comment"># 取值</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> hget car name
<span class="token string">&quot;aa&quot;</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> hget car price
<span class="token string">&quot;500&quot;</span>
<span class="token comment"># 同时设置多个字段的值</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> hmset <span class="token function">cat</span> name cc color black
OK
<span class="token comment"># 同时取多个字段的值</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> hmget <span class="token function">cat</span> name color
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;cc&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;black&quot;</span>
<span class="token comment"># 获取键中的所有字段和字段值</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> hgetall <span class="token function">cat</span>
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;name&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;cc&quot;</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">&quot;color&quot;</span>
<span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">&quot;black&quot;</span>
<span class="token comment"># 判断一个字段是否存在</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> hexists <span class="token function">cat</span> color
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token comment"># hsetnx当字段已经存在时，不执行操作，不存在时执行操作</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> hsetnx <span class="token function">cat</span> color yellow
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">0</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> hsetnx <span class="token function">cat</span> age <span class="token number">3</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token comment"># 增加数字</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> hincrby <span class="token function">cat</span> age <span class="token number">5</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">8</span>
<span class="token comment"># 删除字段</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> hdel <span class="token function">cat</span> age
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token comment"># 获取键中的所有字段</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> hkeys <span class="token function">cat</span>
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;name&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;color&quot;</span>
<span class="token comment"># 获取键值</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> hvals <span class="token function">cat</span>
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;cc&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;yellow&quot;</span>
<span class="token comment"># 获取键对应的字段的数量</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> hlen <span class="token function">cat</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">2</span>
</code></pre></div><h2 id="列表类型"><a href="#列表类型" class="header-anchor">#</a> 列表类型</h2> <blockquote><p>可以存储一个有序的字符串列表，常用操作是向列表两端添加元素，或者是获得列表的某一个片段，一个列表最多能容纳2的32次幂-1个元素</p></blockquote> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token comment"># 向列表左侧插入一个元素</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> lpush num <span class="token number">1</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token comment"># 向列表右侧插入一个元素</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> rpush num <span class="token number">0</span> -1
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">4</span>
<span class="token comment"># 向列表左侧先插入2，然后分别插入3、4</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> lpush num <span class="token number">2</span> <span class="token number">3</span> <span class="token number">4</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">7</span>
<span class="token comment"># 从列表左侧弹出一个元素，并返回被移除元素的值</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> lpop num
<span class="token string">&quot;4&quot;</span>
<span class="token comment"># 从列表右侧弹出一个元素，并返回被移除元素的值</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> rpop num
<span class="token string">&quot;-1&quot;</span>
<span class="token comment"># 获取列表中元素的个数</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> llen num
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">5</span>
<span class="token comment"># 获取列表片段</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> lrange num <span class="token number">2</span> <span class="token number">3</span>
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;2&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;1&quot;</span>
<span class="token comment"># 删除列表中前2个值为1的元素</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> lrem num <span class="token number">2</span> <span class="token number">1</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">2</span>
<span class="token comment"># 获得指定索引的元素的值</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> lindex num <span class="token number">0</span>
<span class="token string">&quot;3&quot;</span>
<span class="token comment"># 将指定索引的元素进行赋值</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> lset num <span class="token number">1</span> <span class="token number">5</span>
OK
<span class="token comment"># 只保留列表指定片段</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> ltrim num <span class="token number">1</span> <span class="token number">3</span>
OK
<span class="token comment"># 将7插入2的后面</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> linsert num after <span class="token number">2</span> <span class="token number">7</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">6</span>
<span class="token comment"># 将9插入到2的前面</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> linsert num before <span class="token number">2</span> <span class="token number">9</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">7</span>
<span class="token comment"># 将元素从一个列表转到另一个列表</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> Rpoplpush num ddd
<span class="token string">&quot;2&quot;</span>
</code></pre></div><h2 id="集合类型"><a href="#集合类型" class="header-anchor">#</a> 集合类型</h2> <blockquote><p>集合中的元素唯一且无序，一个集合（set）键最多可以存储2的32次幂-1个字符串</p></blockquote> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token comment"># 增加一个或多个元素，返回值是成功加入的元素的个数</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> sadd tt <span class="token number">1</span> <span class="token number">2</span> <span class="token number">4</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token comment"># 获取集合中的所有元素</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> smembers tt
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;3&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;4&quot;</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">&quot;5&quot;</span>
<span class="token comment"># 删除一个或多个元素</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> srem tt <span class="token number">2</span> <span class="token number">3</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token comment"># 判断元素是否在集合中</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> sismember tt <span class="token number">4</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> sadd t1 <span class="token number">1</span> <span class="token number">2</span> <span class="token number">3</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">3</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> sadd t2 <span class="token number">2</span> <span class="token number">3</span> <span class="token number">5</span> <span class="token number">7</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">4</span>
<span class="token comment"># sdiff 差集：t1-t2</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token function">sdiff</span> t1 t2
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;1&quot;</span>
<span class="token comment"># sinter 交集：</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> sinter t1 t2
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;2&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;3&quot;</span>
<span class="token comment"># sunion 并集 t1 + t2</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> sunion t1 t2
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;1&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;2&quot;</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">&quot;3&quot;</span>
<span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">&quot;5&quot;</span>
<span class="token number">5</span><span class="token punctuation">)</span> <span class="token string">&quot;7&quot;</span>
<span class="token comment"># 获得集合中元素个数</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> scard t1
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">3</span>
<span class="token comment"># 将t1和t2的交集存储在t3中</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> sinterstore t3 t1 t2
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">2</span>
<span class="token comment"># 随机获取一个集合中的元素</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> srandmember t1
<span class="token string">&quot;2&quot;</span>
<span class="token comment"># 随机获取一个集合中的2个元素，当值为正数的时候，返回对应个数的不重复元素，当值为负数的时候返回对应个数的元素（不考虑是否重复）</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> srandmember t1 <span class="token number">2</span>
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;2&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;3&quot;</span>
<span class="token comment"># 从集合中弹出一个元素</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> spop t1
<span class="token string">&quot;3&quot;</span>
</code></pre></div><h2 id="有序集合"><a href="#有序集合" class="header-anchor">#</a> 有序集合</h2> <blockquote><p>有序的集合，要比列表类型更耗费内存</p></blockquote> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token comment"># 增加集合</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> zadd score <span class="token number">1</span> a1 <span class="token number">2</span> a2 <span class="token number">3</span> a3 <span class="token number">5</span> a4 <span class="token number">4</span> a5
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">2</span>
<span class="token comment"># 修改集合</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> zadd score <span class="token number">7</span> a1
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">0</span>
<span class="token comment"># 增加正无穷</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> zadd score +inf a7
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token comment"># 增加负无穷</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> zadd score -inf a8
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token comment"># 获取指定元素的值</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> zscore score a1
<span class="token string">&quot;7&quot;</span>
<span class="token comment"># 获取排名在某个范围的元素列表</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> zrange score <span class="token number">2</span> <span class="token number">5</span>
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;a3&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;a5&quot;</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">&quot;a4&quot;</span>
<span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">&quot;a1&quot;</span>
<span class="token comment"># 获取排名在某个范围的元素列表，并显示元素对应的分数</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> zrange score <span class="token number">2</span> <span class="token number">5</span> WITHSCORES
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;a3&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;3&quot;</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">&quot;a5&quot;</span>
<span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">&quot;4&quot;</span>
<span class="token number">5</span><span class="token punctuation">)</span> <span class="token string">&quot;a4&quot;</span>
<span class="token number">6</span><span class="token punctuation">)</span> <span class="token string">&quot;5&quot;</span>
<span class="token number">7</span><span class="token punctuation">)</span> <span class="token string">&quot;a1&quot;</span>
<span class="token number">8</span><span class="token punctuation">)</span> <span class="token string">&quot;7&quot;</span>
<span class="token comment"># 获取指定分数范围的元素 及 对应的分数</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> zrangebyscore score <span class="token number">2</span> <span class="token number">4</span> withscores
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;a2&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;2&quot;</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">&quot;a3&quot;</span>
<span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">&quot;3&quot;</span>
<span class="token number">5</span><span class="token punctuation">)</span> <span class="token string">&quot;a5&quot;</span>
<span class="token number">6</span><span class="token punctuation">)</span> <span class="token string">&quot;4&quot;</span>
<span class="token comment"># (4 不包含4</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> zrangebyscore score <span class="token number">2</span> <span class="token punctuation">(</span><span class="token number">4</span> withscores
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;a2&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;2&quot;</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">&quot;a3&quot;</span>
<span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">&quot;3&quot;</span>
<span class="token comment"># 获取负无穷到正无穷的元素</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> zrangebyscore score -inf +inf  withscores
 <span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;a8&quot;</span>
 <span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;-inf&quot;</span>
 <span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">&quot;a2&quot;</span>
 <span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">&quot;2&quot;</span>
 <span class="token number">5</span><span class="token punctuation">)</span> <span class="token string">&quot;a3&quot;</span>
 <span class="token number">6</span><span class="token punctuation">)</span> <span class="token string">&quot;3&quot;</span>
 <span class="token number">7</span><span class="token punctuation">)</span> <span class="token string">&quot;a5&quot;</span>
 <span class="token number">8</span><span class="token punctuation">)</span> <span class="token string">&quot;4&quot;</span>
 <span class="token number">9</span><span class="token punctuation">)</span> <span class="token string">&quot;a4&quot;</span>
<span class="token number">10</span><span class="token punctuation">)</span> <span class="token string">&quot;5&quot;</span>
<span class="token number">11</span><span class="token punctuation">)</span> <span class="token string">&quot;a1&quot;</span>
<span class="token number">12</span><span class="token punctuation">)</span> <span class="token string">&quot;7&quot;</span>
<span class="token number">13</span><span class="token punctuation">)</span> <span class="token string">&quot;a7&quot;</span>
<span class="token number">14</span><span class="token punctuation">)</span> <span class="token string">&quot;inf&quot;</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> zrange score <span class="token number">0</span> -1 withscores
 <span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;a8&quot;</span>
 <span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;-inf&quot;</span>
 <span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">&quot;a2&quot;</span>
 <span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">&quot;2&quot;</span>
 <span class="token number">5</span><span class="token punctuation">)</span> <span class="token string">&quot;a3&quot;</span>
 <span class="token number">6</span><span class="token punctuation">)</span> <span class="token string">&quot;3&quot;</span>
 <span class="token number">7</span><span class="token punctuation">)</span> <span class="token string">&quot;a5&quot;</span>
 <span class="token number">8</span><span class="token punctuation">)</span> <span class="token string">&quot;4&quot;</span>
 <span class="token number">9</span><span class="token punctuation">)</span> <span class="token string">&quot;a4&quot;</span>
<span class="token number">10</span><span class="token punctuation">)</span> <span class="token string">&quot;5&quot;</span>
<span class="token number">11</span><span class="token punctuation">)</span> <span class="token string">&quot;a1&quot;</span>
<span class="token number">12</span><span class="token punctuation">)</span> <span class="token string">&quot;7&quot;</span>
<span class="token number">13</span><span class="token punctuation">)</span> <span class="token string">&quot;a7&quot;</span>
<span class="token number">14</span><span class="token punctuation">)</span> <span class="token string">&quot;inf&quot;</span>
<span class="token comment"># 获取分数大于2的，从第0个人开始的2个人</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> zrangebyscore score <span class="token number">2</span> +inf limit <span class="token number">0</span> <span class="token number">2</span> withscores
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;a2&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;2&quot;</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">&quot;a3&quot;</span>
<span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">&quot;3&quot;</span>
<span class="token comment"># 获取分数小于3的从0开始的2个人</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> zrevrangebyscore score <span class="token number">3</span> <span class="token number">0</span> limit <span class="token number">0</span> <span class="token number">2</span> withscores
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;a3&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;3&quot;</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">&quot;a2&quot;</span>
<span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">&quot;2&quot;</span>
<span class="token comment"># 增加某个元素的分数</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> zincrby score <span class="token number">2</span> a3
<span class="token string">&quot;5&quot;</span>
<span class="token comment"># 获得集合中元素的数量</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> zcard score
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">7</span>
<span class="token comment"># 获取指定分数范围内的元素个数</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> zcount score <span class="token number">0</span> <span class="token number">2</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token comment"># 删除一个或多个元素</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> zrem score a8 a2
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">2</span>
<span class="token comment"># 按照排名范围删除元素</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> zremrangebyrank score <span class="token number">0</span> <span class="token number">2</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">3</span>
<span class="token comment"># 删除分数范围内的元素</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> zremrangebyscore score <span class="token number">1</span> <span class="token number">2</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">2</span>
<span class="token comment"># 获取分数从小到大的排名（从0开始）</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> zrank score a2
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">0</span>
<span class="token comment"># 按照分数从大到小排名(从0开始)</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> zrevrank score a2
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token comment"># 计算多个有序集合的交集，并将结果存入scorestore中，默认进行sum计算</span>
<span class="token comment"># zunionstore:并集，zinterstore:交集</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> zinterstore scorestore <span class="token number">2</span> sc1 sc2
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token comment"># 返回交集结果的最小值</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> zinterstore scorestore <span class="token number">2</span> sc1 sc2 aggregate min
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token comment"># 返回交集结果的最大值</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> zinterstore scorestore <span class="token number">2</span> sc1 sc2 aggregate max
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token comment"># 每个交集参与计算时，元素的分数*该集合的权重</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> zinterstore scorestore <span class="token number">2</span> sc1 sc2 weights <span class="token number">1</span> <span class="token number">0.1</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
</code></pre></div><h2 id="事务"><a href="#事务" class="header-anchor">#</a> 事务</h2> <blockquote><p>Redis中的事务是一组命令的集合，事务同命令一样，都是redis的最小的执行单位，一个事务中的命令，要么都执行，要么都不执行，可以保证事务中的命令依次执行不被其他命令插入</p></blockquote> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token comment"># 一个事务</span>
<span class="token comment"># multi：事务开始，暂存事务;exce:事务结束，开始执行事务</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> MULTI
OK
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> sadd <span class="token string">&quot;user:1:following&quot;</span> <span class="token number">2</span>
QUEUED
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> sadd <span class="token string">&quot;user:2:followers&quot;</span> <span class="token number">1</span>
QUEUED
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token builtin class-name">exec</span>
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token comment"># 语法错误处理：只要有一条命令错误，执行exec命令后redis会直接返回错误命令，语法正确的也不会执行。（2.6.5之前的版本会忽略有语法错误的命令，执行语法正确的命令）</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> multi
OK
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token builtin class-name">set</span> key value
QUEUED
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> errorcommand key
<span class="token punctuation">(</span>error<span class="token punctuation">)</span> ERR unknown <span class="token builtin class-name">command</span> <span class="token string">'errorcommand'</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token builtin class-name">exec</span>
<span class="token punctuation">(</span>error<span class="token punctuation">)</span> EXECABORT Transaction discarded because of previous errors.
<span class="token comment"># 运行错误处理：命令执行时出现的错误，如果一条命令出错，redis会执行未出错的任务，且无法提供回滚功能</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> multi
OK
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token builtin class-name">set</span> aaa <span class="token number">1</span>
QUEUED
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> sadd aaa <span class="token number">2</span>
QUEUED
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token builtin class-name">set</span> aaa <span class="token number">5</span>
QUEUED
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token builtin class-name">exec</span>
<span class="token number">1</span><span class="token punctuation">)</span> OK
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> WRONGTYPE Operation against a key holding the wrong kind of value
<span class="token number">3</span><span class="token punctuation">)</span> OK
</code></pre></div><ul><li>watch命令</li></ul> <blockquote><p>先获得一条命令的返回值，然后再通过这个值执行下一条命令</p></blockquote> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token comment"># 过期时间</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token builtin class-name">set</span> session:111 <span class="token number">124</span>
OK
<span class="token comment"># 设置过期时间，单位秒，必须为整数</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> expire session:111 <span class="token number">60</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token comment"># pexpire的单位是毫秒</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> pexpire aaa <span class="token number">60000</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> get session:111
<span class="token string">&quot;124&quot;</span>ser
<span class="token comment"># 获取剩余多久被删除</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> ttl session:111
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">30</span>
<span class="token comment"># 当键不存在时，ttl命令返回-2</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> ttl session:111
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> -2
<span class="token comment"># pttl查询剩余毫秒</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> pttl aaa
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">49514</span>
<span class="token comment"># 如果没有为键值设置过期时间（默认永久存在），则ttl返回-1</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> ttl key
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> -1
<span class="token comment"># =====================================================</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token builtin class-name">set</span> aaa <span class="token number">1</span>
OK
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> expire aaa <span class="token number">20</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token comment"># persist清除过期时间</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> persist aaa
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> ttl aaa
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> -1
<span class="token comment"># 使用set或者getset也会清除过期时间，其他（如incr/lpush/hset/zrem）均不会影响键的过期时间</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token builtin class-name">set</span> aaa <span class="token number">18</span>
OK
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> ttl aaa
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> -1
<span class="token comment"># 使用时间戳作为过期的时刻（秒）</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> expireat aaa <span class="token number">1526562000</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> ttl aaa
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">181</span>
<span class="token comment"># 使用时间戳作为过期的时刻（毫秒）</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> pexpireat aaa <span class="token number">1526562000000</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> pttl aaa
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">148785</span>
</code></pre></div><ul><li>sort命令</li></ul> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> lpush mylist <span class="token number">1</span> <span class="token number">2</span> <span class="token number">4</span> <span class="token number">3</span> <span class="token number">8</span> <span class="token number">6</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">6</span>
<span class="token comment"># sort命令可以对列表类型、集合类型、有序集合键进行排序</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token function">sort</span> mylist
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;1&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;2&quot;</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">&quot;3&quot;</span>
<span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">&quot;4&quot;</span>
<span class="token number">5</span><span class="token punctuation">)</span> <span class="token string">&quot;6&quot;</span>
<span class="token number">6</span><span class="token punctuation">)</span> <span class="token string">&quot;8&quot;</span>
<span class="token comment"># 降序排序</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token function">sort</span> tt desc
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;10&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;8&quot;</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">&quot;5&quot;</span>
<span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">&quot;4&quot;</span>
<span class="token number">5</span><span class="token punctuation">)</span> <span class="token string">&quot;3&quot;</span>
<span class="token number">6</span><span class="token punctuation">)</span> <span class="token string">&quot;2&quot;</span>
<span class="token comment"># sort可以按照字段顺序排列非数字元素</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token function">sort</span> score alpha
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;a1&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;a2&quot;</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">&quot;a3&quot;</span>
<span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">&quot;a4&quot;</span>
<span class="token number">5</span><span class="token punctuation">)</span> <span class="token string">&quot;a5&quot;</span>
<span class="token number">6</span><span class="token punctuation">)</span> <span class="token string">&quot;a7&quot;</span>
<span class="token comment"># 如果不写alpha的话，sort默认会转换成双精度浮点数</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token function">sort</span> score
<span class="token punctuation">(</span>error<span class="token punctuation">)</span> ERR One or <span class="token function">more</span> scores can<span class="token punctuation">\</span>'t be converted into double
<span class="token comment"># 跳过之前的1个元素，获取之后的3个元素</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token function">sort</span> tt desc limit <span class="token number">1</span> <span class="token number">3</span>
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;8&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;5&quot;</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">&quot;4&quot;</span>
<span class="token comment"># by参数 - 根据参考键进行排序</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token builtin class-name">set</span> itemscore:1 <span class="token number">50</span>
OK
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token builtin class-name">set</span> itemscore:2 <span class="token number">100</span>
OK
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token builtin class-name">set</span> itemscore:3 -10
OK
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> lpush sortbylist <span class="token number">2</span> <span class="token number">1</span> <span class="token number">3</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">3</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token function">sort</span> sortbylist by itemscore:* desc
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;2&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;1&quot;</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">&quot;3&quot;</span>
</code></pre></div><h1 id="任务队列"><a href="#任务队列" class="header-anchor">#</a> 任务队列</h1> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token comment"># 任务队列</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> brpop queue <span class="token number">0</span>
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;queue&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;task&quot;</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> lpush queue task
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token comment"># 优先级任务队列，blpop接收多个键，其中有一个键（从左到右顺序）有元素就会从该键中弹出元素</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> lpush queue2 task
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> lpush queue1 tt
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> blpop queue1 queue2 queue3 <span class="token number">0</span>
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;queue1&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;tt&quot;</span>
<span class="token comment"># 发布和订阅模式，publish发布， subscribe订阅</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> subscribe channel1
Reading messages<span class="token punctuation">..</span>. <span class="token punctuation">(</span>press Ctrl-C to quit<span class="token punctuation">)</span>
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;subscribe&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;channel1&quot;</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> publish channel1 hello
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token comment"># 按照规则订阅，会匹配channel.1等，但是不会匹配channel.</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> psubscribe channel.?*
Reading messages<span class="token punctuation">..</span>. <span class="token punctuation">(</span>press Ctrl-C to quit<span class="token punctuation">)</span>
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;psubscribe&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;channel.?*&quot;</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> publish channel.9 nihao
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
</code></pre></div><h2 id="编码格式"><a href="#编码格式" class="header-anchor">#</a> 编码格式</h2> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token comment"># 获取redis内部编码方式</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token builtin class-name">set</span> foo bar
OK
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> object encoding foo
<span class="token string">&quot;embstr&quot;</span>
</code></pre></div><h2 id="python与redis"><a href="#python与redis" class="header-anchor">#</a> python与redis</h2> <div class="language-py extra-class"><pre class="language-py"><code><span class="token keyword">import</span> redis
<span class="token comment"># 默认连接地址，127.0.0.1 6379</span>
r <span class="token operator">=</span> redis<span class="token punctuation">.</span>StrictRedis<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># 指定连接地址</span>
r <span class="token operator">=</span> redis<span class="token punctuation">.</span>StrictRedis<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'127.0.0.1'</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">6379</span><span class="token punctuation">,</span> db<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token comment"># get命令</span>
r<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">)</span>    <span class="token comment"># 'bar'</span>
<span class="token comment"># 字典用法</span>
r<span class="token punctuation">.</span>hmset<span class="token punctuation">(</span><span class="token string">'dict'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">'name'</span><span class="token punctuation">:</span><span class="token string">'aa'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
r<span class="token punctuation">.</span>hgetall<span class="token punctuation">(</span><span class="token string">'dict'</span><span class="token punctuation">)</span>
<span class="token comment"># 事务</span>
r<span class="token punctuation">.</span>pipeline<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">set</span><span class="token punctuation">(</span><span class="token string">&quot;foo&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;bar&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># 管道</span>
r<span class="token punctuation">.</span>pipeline<span class="token punctuation">(</span>transaction<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">set</span><span class="token punctuation">(</span><span class="token string">&quot;foo&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;bar&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><ul><li>redis.Redis和redis.StrictRedis</li></ul> <div class="language- extra-class"><pre class="language-text"><code>StrictRedis:用于实现大部分官方的命令，并使用官方的语法和命令
Redis:是StrictRedis的子类，用于向后兼容旧版本的redis-py
官方推荐使用StrictRedis
连接redis，加上decode_responses=True，写入的键值对中的value为str类型，不加这个参数写入的则为字节类型。
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/blog-web/bigData/mysql.html" class="prev">
        MySql
      </a></span> <span class="next"><a href="/blog-web/bigData/es.html">
        Elasticsearch
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/blog-web/assets/js/app.ed324a7a.js" defer></script><script src="/blog-web/assets/js/2.7ae4b6a2.js" defer></script><script src="/blog-web/assets/js/26.2b74cdb3.js" defer></script>
  </body>
</html>
